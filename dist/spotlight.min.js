/*!
 * Spotlight JS v1.0.0
 * Copyright (c) 2025 Anastasia Shebalkina
 * Licensed under the MIT License (see LICENSE)
 *
 * Includes Tabler Icons (https://tabler.io/icons), MIT License
 * Copyright (c) 2020-2025 Tabler Icons Authors (see LICENSE.tabler-icons)
 */
(function(){"use strict";(()=>{const g=(h,t=document)=>Array.from(t.querySelectorAll(h)),c=(h,t={},e=[])=>{const n=document.createElement(h);return Object.entries(t).forEach(([s,i])=>{s==="style"?Object.assign(n.style,i):s.startsWith("on")&&typeof i=="function"?n.addEventListener(s.slice(2),i):s==="dataset"?Object.entries(i).forEach(([a,o])=>n.dataset[a]=o):n.setAttribute(s,i)}),e.forEach(s=>typeof s=="string"?n.appendChild(document.createTextNode(s)):n.appendChild(s)),n},S=`
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-arrows-maximize"><path stroke="none" d="M0 0h24v24H0z"/><path d="M16 4h4v4m-6 2 6-6M8 20H4v-4m0 4 6-6m6 6h4v-4m-6-2 6 6M8 4H4v4m0-4 6 6"/></svg>
  `,M=`
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-arrows-minimize"><path stroke="none" d="M0 0h24v24H0z"/><path d="M5 9h4V5M3 3l6 6m-4 6h4v4m-6 2 6-6m10-6h-4V5m0 4 6-6m-2 12h-4v4m0-4 6 6"/></svg>
  `;class L{constructor(){this.collections=[],this.overlay=null,this.state={open:!1,collectionIndex:0,itemIndex:0,scale:1,baseScale:1,translateX:0,translateY:0,fullscreen:!1},this._rafId=null,this._renderActive=!1,this.renderState={scale:1,translateX:0,translateY:0},this._uiHideTimer=null,this._uiHideDelay=1500,this._wheelSwipeAccum=0,this._wheelSwipeTimer=null,this._wheelMode=null,this._swipeActive=!1,this._swipeDirection=0,this._pendingSlideDir=0,this._init()}_init(){this._injectStyles(),this._scanCollections(),this._createOverlay(),this.liveRegion=c("div",{"aria-live":"polite",style:{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0,0,0,0)",whiteSpace:"nowrap",border:"0"}}),this.nodes.shell.appendChild(this.liveRegion),this._bindGlobalListeners(),console.log(`Spotlight initialized with ${this.collections.length} collections.`)}_scanCollections(){const t=[];g("article").forEach(e=>{const n=g("img",e);n.length&&t.push({type:"article",el:e,imgs:n})}),g(".gallery").forEach(e=>{if(!t.some(n=>n.el===e)){const n=g("img",e);t.push({type:"gallery",el:e,imgs:n})}}),t.forEach((e,n)=>{const s=[];e.imgs.forEach((i,a)=>{const o=i.dataset.src||i.getAttribute("src")||i.currentSrc||null;if(!o)return;const l=i.closest("figure"),r=l?l.querySelector("figcaption"):null,d=r?r.textContent.trim():(i.getAttribute("data-caption")||i.getAttribute("alt")||"").trim();s.push({src:o,el:i,caption:d}),i.dataset.spotlightCollection=String(this.collections.length),i.dataset.spotlightIndex=String(s.length-1),i.style.cursor="zoom-in"}),s.length&&this.collections.push({id:`spot-${this._randId()}`,container:e.el,items:s})})}_randId(){return Math.random().toString(36).slice(2,9)}_createOverlay(){const t=c("div",{id:"spot-overlay","aria-hidden":"true",tabindex:"-1"}),e=c("div",{id:"spot-bg"}),n=c("div",{id:"spot-shell",role:"dialog","aria-modal":"true"}),s=c("div",{id:"spot-stage",class:"spot-stage"}),i=c("button",{id:"spot-prev",class:"spot-nav","aria-label":"Previous image","data-dir":"-1"});i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-compact-left"><path stroke="none" d="M0 0h24v24H0z"/><path d="m13 20-3-8 3-8"/></svg>';const a=c("div",{id:"spot-canvas",class:"spot-canvas"}),o=c("div",{id:"spot-transform",class:"spot-transform"}),l=c("img",{id:"spot-img",draggable:"false"});o.appendChild(l),a.appendChild(o);const r=c("button",{id:"spot-next",class:"spot-nav","aria-label":"Next image","data-dir":"1"});r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-compact-right"><path stroke="none" d="M0 0h24v24H0z"/><path d="m11 4 3 8-3 8"/></svg>',s.appendChild(i),s.appendChild(a),s.appendChild(r);const d=c("div",{id:"spot-ui",class:"spot-ui spot-ui-visible"}),p=c("div",{id:"spot-topbar",class:"spot-topbar"}),u=c("div",{id:"spot-counter",class:"spot-counter"}),m=c("div",{class:"spot-controls"}),f=c("button",{id:"spot-zoom-out",class:"spot-btn","aria-label":"Zoom out"});f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-zoom-out"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0m4 0h6m8 11-6-6"/></svg>';const b=c("button",{id:"spot-zoom-display",class:"spot-btn","aria-label":"Reset zoom"},["100%"]),_=c("button",{id:"spot-zoom-in",class:"spot-btn","aria-label":"Zoom in"});_.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-zoom-in"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0m4 0h6m-3-3v6m11 8-6-6"/></svg>';const y=c("button",{id:"spot-fullscreen",class:"spot-btn","aria-label":"Toggle fullscreen"}),w=c("button",{id:"spot-close",class:"spot-btn","aria-label":"Close"});w.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-x"><path stroke="none" d="M0 0h24v24H0z"/><path d="M18 6 6 18M6 6l12 12"/></svg>',m.appendChild(f),m.appendChild(b),m.appendChild(_),m.appendChild(y),m.appendChild(w),p.appendChild(u),p.appendChild(m);const x=c("div",{id:"spot-caption",class:"spot-caption"});d.appendChild(p),d.appendChild(x),n.appendChild(s),n.appendChild(d),t.appendChild(e),t.appendChild(n),document.body.appendChild(t),this.overlay=t,this.nodes={overlay:t,bg:e,shell:n,ui:d,closeBtn:w,zoomIn:_,zoomOut:f,zoomDisplay:b,fullscreenBtn:y,prevBtn:i,nextBtn:r,canvas:a,transform:o,imgNode:l,counter:u,caption:x},this._pointerOverUi=!1,this._pointerOverUiCount=0;const k=Array.from(t.querySelectorAll(".spot-btn")),C=[this.nodes.prevBtn,this.nodes.nextBtn,this.nodes.caption,p,...k].filter(Boolean),I=()=>{this._pointerOverUiCount=(this._pointerOverUiCount||0)+1,this._pointerOverUi=!0,this._showUiImmediate()},z=()=>{this._pointerOverUiCount=Math.max(0,(this._pointerOverUiCount||0)-1),this._pointerOverUiCount===0&&(this._pointerOverUi=!1,this._scheduleUiHide())};C.forEach(v=>{v.addEventListener("pointerenter",I),v.addEventListener("pointerleave",z)}),this.nodes.closeBtn.addEventListener("click",()=>this.close()),this.nodes.bg.addEventListener("click",()=>this.close()),this.nodes.prevBtn.addEventListener("click",()=>this.prev()),this.nodes.nextBtn.addEventListener("click",()=>this.next()),this.nodes.zoomIn.addEventListener("click",()=>this._zoomBy(1.2)),this.nodes.zoomOut.addEventListener("click",()=>this._zoomBy(1/1.2)),this.nodes.zoomDisplay.addEventListener("click",()=>this._resetZoom()),this.nodes.fullscreenBtn.addEventListener("click",()=>this._toggleFullscreen()),t.addEventListener("pointermove",()=>this._handleUserActivity()),t.addEventListener("pointerdown",()=>this._handleUserActivity()),t.addEventListener("touchstart",()=>this._handleUserActivity(),{passive:!0}),this._updateFullscreenButton(),t.addEventListener("wheel",v=>{this.state.open&&this._isPointerOverStage(v)&&v.preventDefault()},{passive:!1})}_isPointerOverStage(t){const e=this.nodes.canvas.getBoundingClientRect();return t.clientX>=e.left&&t.clientX<=e.right&&t.clientY>=e.top&&t.clientY<=e.bottom}_bindGlobalListeners(){window.addEventListener("keydown",i=>{if(!this.state.open)return;this._handleUserActivity();const a=i.code||"",o=i.key||"",l=String(o).toLowerCase();a==="Escape"||o==="Escape"||o==="Esc"?this.close():a==="ArrowRight"||a==="KeyL"||o==="ArrowRight"||l==="l"||o==="Right"?this.next():a==="ArrowLeft"||a==="KeyH"||o==="ArrowLeft"||l==="h"||o==="Left"?this.prev():a==="Equal"||a==="NumpadAdd"||o==="+"||o==="="?this._zoomBy(1.2):a==="Minus"||a==="NumpadSubtract"||o==="-"||o==="_"?this._zoomBy(1/1.2):a==="Digit0"||a==="Numpad0"||o==="0"||o===")"?this._resetZoom():(a==="KeyF"||l==="f")&&this._toggleFullscreen()}),this.nodes.canvas.addEventListener("wheel",i=>{if(!this.state.open)return;this._handleUserActivity(),this._detectWheelMode(i)==="swipe"?(i.preventDefault(),this._handleSwipeWheel(i.deltaX)):(i.preventDefault(),this._handleWheelZoom(i)),this._scheduleWheelGestureReset()},{passive:!1});let t=!1,e={x:0,y:0};this.nodes.imgNode.addEventListener("pointerdown",i=>{if(this.state.open&&(this._handleUserActivity(),!!i.isPrimary)){t=!0,e.x=i.clientX,e.y=i.clientY;try{this.nodes.imgNode.setPointerCapture(i.pointerId)}catch{}}}),window.addEventListener("pointermove",i=>{if(!t||(this._handleUserActivity(),i.pointerType==="touch"&&Math.abs(this.state.scale-(this.state.baseScale||1))<.1))return;const a=i.clientX-e.x,o=i.clientY-e.y;e.x=i.clientX,e.y=i.clientY,this.state.translateX+=a,this.state.translateY+=o,this._startRenderLoop()}),window.addEventListener("pointerup",i=>{if(t)try{this.nodes.imgNode.releasePointerCapture(i.pointerId)}catch{}t=!1});let n=null;this.nodes.canvas.addEventListener("touchstart",i=>{this.state.open&&(this._handleUserActivity(),i.touches.length===1?n={x:i.touches[0].clientX,y:i.touches[0].clientY,t:Date.now()}:n=null)},{passive:!0}),this.nodes.canvas.addEventListener("touchend",i=>{if(!this.state.open||!n)return;this._handleUserActivity();const a=i.changedTouches&&i.changedTouches[0]&&i.changedTouches[0].clientX||0,o=i.changedTouches&&i.changedTouches[0]&&i.changedTouches[0].clientY||0,l=a-n.x,r=o-n.y,d=Date.now()-n.t;n=null;const p=Math.abs(l),u=Math.abs(r);p>u&&p>20&&d<500&&Math.abs(this.state.scale-(this.state.baseScale||1))<.25&&(l<0?this.next():this.prev())},{passive:!0}),this._bindPinch(),new ResizeObserver(()=>{this.state.open&&(this._fitImageToViewport(),this._applyTransform({immediate:!0}))}).observe(this.nodes.canvas),document.addEventListener("fullscreenchange",()=>this._syncFullscreenState())}_handleSwipeWheel(t){this._handleUserActivity();const e=45,n=this.state.baseScale||1;if(!(Math.abs(this.state.scale-n)>Math.max(.8,n*.5))){if(this._swipeActive){const s=t===0?0:t>0?1:-1,i=Math.abs(t)<1.5;if(s&&s!==this._swipeDirection||i)this._endWheelGesture();else return}this._wheelSwipeAccum+=t,this._wheelSwipeAccum>e?this._commitSwipeNavigation(1):this._wheelSwipeAccum<-e&&this._commitSwipeNavigation(-1)}}_commitSwipeNavigation(t){const e=Date.now();if(e-(this._lastSwipeTime||0)<500){this._wheelSwipeAccum=0;return}this._lastSwipeTime=e,this._swipeActive=!0,this._swipeDirection=t,this._wheelSwipeAccum=0,t<0?this.prev():t>0&&this.next()}_detectWheelMode(t){if(this._wheelMode)return this._wheelMode;if(t.ctrlKey)return this._wheelMode="zoom",this._wheelMode;const e=Math.abs(t.deltaX),n=Math.abs(t.deltaY),s=this.state.baseScale||1,i=Math.abs(this.state.scale-s)<=Math.max(.8,s*.5),a=e>n*.65&&e-n>1||n<2;return i&&a?this._wheelMode="swipe":this._wheelMode="zoom",this._wheelMode}_handleWheelZoom(t){const e=-t.deltaY,n=1.04,s=e>0?n:1/n;this._zoomAtPoint(s,t.clientX,t.clientY)}_scheduleWheelGestureReset(){clearTimeout(this._wheelSwipeTimer),this._wheelSwipeTimer=setTimeout(()=>this._endWheelGesture(),140)}_endWheelGesture(){this._wheelSwipeTimer&&(clearTimeout(this._wheelSwipeTimer),this._wheelSwipeTimer=null),this._wheelSwipeAccum=0,this._swipeActive=!1,this._wheelMode=null,this._swipeDirection=0}_handleUserActivity(){this.state.open&&(this._showUiImmediate(),this._scheduleUiHide())}_scheduleUiHide(){clearTimeout(this._uiHideTimer),this._uiHideTimer=setTimeout(()=>{this._pointerOverUi?this._scheduleUiHide():this._hideUi()},this._uiHideDelay)}_showUiImmediate(){this.nodes?.ui&&(this.nodes.ui.classList.add("spot-ui-visible"),this.nodes.ui.classList.remove("spot-ui-hidden"),this.overlay&&this.overlay.classList.remove("spot-nav-hidden"))}_hideUi(){this.nodes?.ui&&(this.nodes.ui.classList.add("spot-ui-hidden"),this.nodes.ui.classList.remove("spot-ui-visible"),this.overlay&&this.overlay.classList.add("spot-nav-hidden"))}_toggleFullscreen(){this._handleUserActivity(),this.state.fullscreen?this._exitFullscreen():this._enterFullscreen()}_enterFullscreen(){const t=this.overlay;if(!(!t||document.fullscreenElement===t)){if(t.requestFullscreen){const e=t.requestFullscreen();e&&typeof e.catch=="function"&&e.catch(()=>{})}this._syncFullscreenState()}}_exitFullscreen(){if(document.fullscreenElement&&document.exitFullscreen){const t=document.exitFullscreen();t&&typeof t.catch=="function"&&t.catch(()=>{})}this._syncFullscreenState()}_syncFullscreenState(){const t=document.fullscreenElement===this.overlay;this.state.fullscreen=!!t,this._updateFullscreenButton()}_updateFullscreenButton(){const t=this.nodes?.fullscreenBtn;t&&(t.innerHTML=this.state.fullscreen?M:S,t.setAttribute("aria-label",this.state.fullscreen?"Exit fullscreen":"Enter fullscreen"),t.setAttribute("aria-pressed",String(this.state.fullscreen)))}_animateSlide(t,e){this._handleUserActivity(),this._pendingSlideDir=t||0,typeof e=="function"&&e()}_playSlideIn(t){const e=this.nodes?.imgNode;if(!e)return;const n=t||0;e.style.transition="none",n?(e.style.transform=`translateX(${n*60}px) scale(0.96)`,e.style.opacity="0"):(e.style.transform="translateX(0) scale(1)",e.style.opacity="1"),requestAnimationFrame(()=>{e.style.transition="transform 650ms cubic-bezier(0.3, 1, 0.3, 1), opacity 400ms ease",e.style.transform="translateX(0) scale(1)",e.style.opacity="1";const s=()=>{e.style.transition="",e.style.transform="",e.removeEventListener("transitionend",s)};e.addEventListener("transitionend",s,{once:!0})})}_bindPinch(){let t=new Map,e=0,n=1;const s=o=>{if(this.state.open&&(this._handleUserActivity(),t.set(o.pointerId,o),t.size===2)){const[l,r]=Array.from(t.values());e=Math.hypot(r.clientX-l.clientX,r.clientY-l.clientY),n=this.state.scale}},i=o=>{if(t.has(o.pointerId)){if(!this.state.open){t.clear();return}if(this._handleUserActivity(),t.set(o.pointerId,o),t.size===2){const[l,r]=Array.from(t.values()),d=Math.hypot(r.clientX-l.clientX,r.clientY-l.clientY);if(e>0){const u=1+(d/e-1)*.5;this.state.scale=Math.min(8,Math.max(.2,n*u)),this._startRenderLoop()}}}},a=o=>{t.delete(o.pointerId),t.size<2&&(e=0,n=this.state.scale)};this.nodes.canvas.addEventListener("pointerdown",s),window.addEventListener("pointermove",i),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}openCollection(t,e=0){this.collections[t]&&(this.state.open=!0,this.state.collectionIndex=t,this.state.itemIndex=e,this._handleUserActivity(),this._showOverlay(),this._loadItem())}_showOverlay(){this.overlay.style.display="block",this._lastFocused=document.activeElement,requestAnimationFrame(()=>{this.overlay.classList.add("spot-open"),this.overlay.setAttribute("aria-hidden","false"),document.documentElement.style.overflow="hidden",this._showUiImmediate(),this._scheduleUiHide(),this.nodes.shell.focus()})}close(){this.state.open&&(this.overlay.classList.remove("spot-open"),this.overlay.setAttribute("aria-hidden","true"),document.documentElement.style.overflow="",this.state.open=!1,this.state.fullscreen=!1,this._exitFullscreen(),this._updateFullscreenButton(),clearTimeout(this._uiHideTimer),clearTimeout(this._wheelSwipeTimer),this._wheelSwipeAccum=0,this._wheelMode=null,this._swipeActive=!1,this._swipeDirection=0,this._pendingSlideDir=0,this._hideUi(),setTimeout(()=>{this.state.open||(this.overlay.style.display="none"),this._lastFocused&&this._lastFocused.focus()},220))}prev(){const t=this.collections[this.state.collectionIndex];t&&(this.state.itemIndex=(this.state.itemIndex-1+t.items.length)%t.items.length,this._animateSlide(-1,()=>this._loadItem()))}next(){const t=this.collections[this.state.collectionIndex];t&&(this.state.itemIndex=(this.state.itemIndex+1)%t.items.length,this._animateSlide(1,()=>this._loadItem()))}_loadItem(){const t=this.collections[this.state.collectionIndex];if(!t)return;const e=t.items[this.state.itemIndex];if(!e)return;const n=this._pendingSlideDir||0;this._pendingSlideDir=0,this._resetRenderState(),this.nodes.imgNode.style.opacity="0",this.nodes.imgNode.src="",this.nodes.counter.textContent=`${this.state.itemIndex+1} / ${t.items.length}`,this._updateCaption(e.caption),this.liveRegion&&(this.liveRegion.textContent=`Image ${this.state.itemIndex+1} of ${t.items.length}${e.caption?": "+e.caption:""}`);const s=this.nodes.imgNode;s.onload=null,s.onerror=null,s.style.opacity="0",s.src="",s.onload=()=>{requestAnimationFrame(()=>{this._fitImageToViewport(),this._applyTransform({immediate:!0}),this._playSlideIn(n)})},s.onerror=()=>{s.src="",this._updateCaption("Failed to load image"),s.style.opacity="1"},s.src=e.src,/\.svg($|\?)/i.test(e.src)?s.classList.add("spot-svg"):s.classList.remove("spot-svg"),s.complete&&s.naturalWidth&&s.onload?.()}_updateCaption(t){if(!this.nodes||!this.nodes.caption)return;const e=(t||"").trim();e?(this.nodes.caption.textContent=e,this.nodes.caption.classList.remove("spot-caption-empty"),this.nodes.caption.style.display=""):(this.nodes.caption.textContent="",this.nodes.caption.classList.add("spot-caption-empty"),this.nodes.caption.style.display="none")}_resetRenderState(){this.state.scale=1,this.state.baseScale=1,this.state.translateX=0,this.state.translateY=0,this.renderState.scale=1,this.renderState.translateX=0,this.renderState.translateY=0,this._renderActive=!1,this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=null)}_startRenderLoop(){this._rafId||(this._renderActive=!0,this._renderLoop())}_renderLoop(){if(!this._renderActive||!this.state.open){this._rafId=null;return}const{scale:t,translateX:e,translateY:n}=this.state,s=this.renderState,i=.15;if(s.scale+=(t-s.scale)*i,s.translateX+=(e-s.translateX)*i,s.translateY+=(n-s.translateY)*i,Math.abs(t-s.scale)<.001&&Math.abs(e-s.translateX)<.1&&Math.abs(n-s.translateY)<.1&&(s.scale=t,s.translateX=e,s.translateY=n,this._renderActive=!1),this.nodes.transform){this.nodes.transform.style.transition="none",this.nodes.transform.style.transform=`translate(${s.translateX}px, ${s.translateY}px) scale(${s.scale})`,this._updateZoomDisplay(s.scale);const a=this.nodes.imgNode;a.style.cursor=Math.abs(s.scale-(this.state.baseScale||1))>.02||Math.abs(s.translateX)>1||Math.abs(s.translateY)>1?"grab":"zoom-out"}this._renderActive?this._rafId=requestAnimationFrame(()=>this._renderLoop()):this._rafId=null}_fitImageToViewport(){const t=this.nodes?.imgNode;if(!t)return;const e=Math.max(window.innerWidth,1),n=Math.max(window.innerHeight,1),s=t.naturalWidth||t.width||t.clientWidth,i=t.naturalHeight||t.height||t.clientHeight;if(!s||!i)return;const a=e/s,o=n/i,l=e>=n;let r=1;if(l){const d=s<=e,p=i<=n;d||p?r=1:r=o,r=Math.min(r,1)}else r=Math.min(a,o);r=Math.min(8,Math.max(.05,r)),this.state.baseScale=r,this.state.scale=r,this.state.translateX=0,this.state.translateY=0,this.renderState.scale=r,this.renderState.translateX=0,this.renderState.translateY=0}_applyTransform(t={}){const e=t.immediate||!this.state.open;if(!this.nodes||!this.nodes.transform)return;const{scale:n,translateX:s,translateY:i}=this.state,a=this.nodes.transform;e?a.style.transition="none":a.style.transition="",a.style.transform=`translate(${s}px, ${i}px) scale(${n})`,this._updateZoomDisplay(n);const o=this.nodes.imgNode;o.style.cursor=Math.abs(n-(this.state.baseScale||1))>.02||Math.abs(s)>1||Math.abs(i)>1?"grab":"zoom-out"}_updateZoomDisplay(t){if(!this.nodes||!this.nodes.zoomDisplay)return;const e=Math.round((t||1)*100);this.nodes.zoomDisplay.textContent=`${e}%`,this.nodes.zoomDisplay.title=`Reset zoom (${e}%)`}_zoomBy(t){this._handleUserActivity(),this.state.scale=Math.min(8,Math.max(.2,this.state.scale*t)),this._startRenderLoop()}_resetZoom(){this._handleUserActivity(),this.state.scale=this.state.baseScale||1,this.state.translateX=0,this.state.translateY=0,this._startRenderLoop()}_zoomAtPoint(t,e,n){this._handleUserActivity();const s=(this.nodes.transform||this.nodes.imgNode).getBoundingClientRect(),i=e-s.left,a=n-s.top,o=this.state.scale,l=Math.min(8,Math.max(.2,o*t)),r=i/s.width,d=a/s.height,p=o,u=l;s.width/2,s.height/2;const m=(r-.5)*s.width*(u/p-1),f=(d-.5)*s.height*(u/p-1);this.state.translateX-=m,this.state.translateY-=f,this.state.scale=l,this._startRenderLoop()}attachImage(t,e,n){t.dataset.spotlightCollection=String(e),t.dataset.spotlightIndex=String(n),t.addEventListener("click",s=>{s.preventDefault(),this.openCollection(e,n)})}_injectStyles(){if(document.getElementById("spotlight-styles"))return;const t=`:root{--spot-bg:rgba(6,6,8,1);--spot-ui-bg:rgba(20,20,24,0.78);--spot-ui-fg:rgba(255,255,255,0.95);--spot-muted:rgba(255,255,255,0.74);--spot-btn-bg:rgba(255,255,255,0.08);--spot-btn-border:rgba(255,255,255,0.1);--spot-shadow:0 10px 40px rgba(0,0,0,0.45);--spot-anim:300ms cubic-bezier(.22,.9,.35,1);--spot-font:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif}@media (prefers-color-scheme:light){:root{--spot-bg:rgba(250,250,252,1);--spot-ui-bg:rgba(255,255,255,0.8);--spot-ui-fg:rgba(17,17,20,0.92);--spot-muted:rgba(17,17,20,0.7);--spot-btn-bg:rgba(0,0,0,0.05);--spot-btn-border:rgba(0,0,0,0.1);--spot-shadow:0 2px 80px rgba(0,0,0,0.15)}#spot-overlay .spot-nav{background:rgba(255,255,255,.92);border-color:rgba(0,0,0,.06);box-shadow:0 6px 18px rgba(10,10,10,.06)}#spot-overlay .spot-nav:hover{background:rgba(245,245,245,.98)}}#spot-overlay{display:none;position:fixed;inset:0;z-index:2147483646;font-family:var(--spot-font);-webkit-font-smoothing:antialiased;opacity:0;transition:opacity var(--spot-anim);touch-action:none}#spot-overlay,#spot-overlay *{-webkit-user-select:none;user-select:none}#spot-overlay.spot-open{pointer-events:auto;opacity:1}#spot-bg,.spot-nav svg{transition:opacity var(--spot-anim)}#spot-bg,#spot-shell{position:fixed;inset:0;opacity:0}#spot-bg{background:var(--spot-bg)}#spot-shell{pointer-events:none;transform:scale(.996);transition:opacity var(--spot-anim),transform var(--spot-anim)}#spot-overlay.spot-open #spot-shell{opacity:1;transform:scale(1)}#spot-overlay.spot-open #spot-bg,.spot-controls .spot-btn:hover,.spot-nav:hover svg{opacity:1}#spot-canvas,#spot-stage{inset:0;display:flex;align-items:center;justify-content:center}#spot-stage{position:fixed;pointer-events:none;z-index:2147483645}#spot-canvas{position:absolute;overflow:hidden;pointer-events:auto}#spot-transform{will-change:transform;touch-action:none;transform-origin:center center;cursor:grab;transition:transform var(--spot-anim)}#spot-transform img{display:block;width:auto;height:auto;max-width:none;max-height:none;object-fit:contain;user-select:none;-webkit-user-drag:none;pointer-events:auto;transition:opacity 180ms ease}#spot-transform img.spot-svg{width:100%;height:auto;max-width:100vw;max-height:100vh}.spot-caption,.spot-nav,.spot-topbar{pointer-events:auto;color:var(--spot-ui-fg);box-shadow:var(--spot-shadow)}.spot-nav{position:absolute;top:50%;transform:translateY(-50%);width:50px;height:50px;border-radius:50%;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.12);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;font-size:0;cursor:pointer;opacity:1;transition:background var(--spot-anim),transform var(--spot-anim),opacity var(--spot-anim);z-index:2147483650}.spot-nav svg{width:30px;height:30px;opacity:.5}.spot-nav:hover{background:rgba(0,0,0,.45)}.spot-nav[data-dir="-1"]{left:22px;--nav-offset:-40px}.spot-nav[data-dir="1"]{right:22px;--nav-offset:40px}#spot-ui{position:fixed;inset:0;pointer-events:none;display:flex;flex-direction:column;justify-content:space-between;gap:20px;z-index:2147483647}.spot-caption,.spot-topbar{background:var(--spot-ui-bg);backdrop-filter:blur(18px)}.spot-controls,.spot-topbar{display:flex;align-items:center}.spot-topbar{gap:18px;height:50px}.spot-controls{margin-left:auto;gap:10px}.spot-controls svg{width:21px;height:21px}.spot-controls .spot-btn{opacity:.5;transition:opacity var(--spot-anim),background 150ms ease;will-change:opacity}.spot-btn,.spot-counter{height:50px;color:var(--spot-ui-fg);display:flex;justify-content:center;font-weight:600}.spot-counter{font-size:15px;letter-spacing:.08em;opacity:.5;min-width:10ch;max-width:12ch;padding:15px;box-sizing:border-box;align-items:flex-end;white-space:nowrap;font-variant-numeric:tabular-nums;-webkit-font-feature-settings:"tnum"1;font-feature-settings:"tnum"1}.spot-btn{width:50px;border-radius:6px;border:0;background:0 0;align-items:center;font-size:16px;cursor:pointer;transition:background 150ms ease}.spot-btn:active{transform:none}#spot-caption{padding:14px 18px;font-size:21px;line-height:1.45;color:var(--spot-muted)}#spot-caption.spot-caption-empty{opacity:0;pointer-events:none}#spot-overlay.spot-nav-hidden .spot-nav{opacity:0;pointer-events:none;transform:translateY(-50%) translateX(var(--nav-offset))}#spot-ui .spot-caption,#spot-ui .spot-topbar{transition:opacity var(--spot-anim),transform var(--spot-anim);will-change:opacity,transform}#spot-ui.spot-ui-hidden .spot-topbar{opacity:0;transform:translateY(-18px);pointer-events:none}#spot-ui.spot-ui-hidden .spot-caption{opacity:0;transform:translateY(18px);pointer-events:none}#spot-ui.spot-ui-visible .spot-caption,#spot-ui.spot-ui-visible .spot-topbar{opacity:1;transform:translateY(0)}@media (max-width:600px){#spot-ui{padding:12px}.spot-topbar{gap:10px}.spot-counter{min-width:auto;font-size:14px;padding:0 8px;height:40px}.spot-btn,.spot-nav{width:40px;height:40px}.spot-nav[data-dir="-1"]{left:10px;--nav-offset:-20px}.spot-nav[data-dir="1"]{right:10px;--nav-offset:20px}}@media (prefers-reduced-motion:reduce){:root{--spot-anim:0s}#spot-transform{transition:none}}`,e=c("style",{id:"spotlight-styles",type:"text/css"});e.appendChild(document.createTextNode(t)),document.head.appendChild(e)}}function A(){if(window.__spotlight_instance)return window.__spotlight_instance;const h=new L;return window.__spotlight_instance=h,h}window.addEventListener("click",h=>{const t=h.target.closest("img");if(!t||!t.closest("article, .gallery"))return;h.preventDefault();const n=A(),s=parseInt(t.dataset.spotlightCollection||"0",10),i=parseInt(t.dataset.spotlightIndex||"0",10);n.openCollection(s,i)}),window.Spotlight={get instance(){return window.__spotlight_instance||null},open:(h=0,t=0)=>{window.__spotlight_instance||initSpotlightOnce(),window.__spotlight_instance.openCollection(h,t)},rescan:()=>{const h=window.__spotlight_instance||initSpotlightOnce();try{h.overlay&&h.overlay.parentNode&&h.overlay.parentNode.removeChild(h.overlay)}catch{}return delete window.__spotlight_instance,initSpotlightOnce()}}})()})();
