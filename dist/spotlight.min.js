/*!
 * Spotlight JS v1.0.1
 * Copyright (c) 2025 Anastasia Shebalkina
 * Licensed under the MIT License (see LICENSE)
 *
 * Includes Tabler Icons (https://tabler.io/icons), MIT License
 * Copyright (c) 2020-2025 Tabler Icons Authors (see LICENSE.tabler-icons)
 */
(function(){"use strict";(()=>{const y="spotlight-natural-scrolling",b=(d,t=document)=>Array.from(t.querySelectorAll(d)),c=(d,t={},s=[])=>{const i=document.createElement(d);return Object.entries(t).forEach(([e,n])=>{e==="style"?Object.assign(i.style,n):e.startsWith("on")&&typeof n=="function"?i.addEventListener(e.slice(2),n):e==="dataset"?Object.entries(n).forEach(([o,a])=>i.dataset[o]=a):i.setAttribute(e,n)}),s.forEach(e=>typeof e=="string"?i.appendChild(document.createTextNode(e)):i.appendChild(e)),i},L=`
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-arrows-maximize" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="M16 4h4v4m-6 2 6-6M8 20H4v-4m0 4 6-6m6 6h4v-4m-6-2 6 6M8 4H4v4m0-4 6 6"/></svg>
  `,C=`
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-arrows-minimize" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="M5 9h4V5M3 3l6 6m-4 6h4v4m-6 2 6-6m10-6h-4V5m0 4 6-6m-2 12h-4v4m0-4 6 6"/></svg>
  `;class A{constructor(){this.collections=[],this.overlay=null,this.state={open:!1,collectionIndex:0,itemIndex:0,scale:1,baseScale:1,translateX:0,translateY:0,fullscreen:!1},this._rafId=null,this._renderActive=!1,this.renderState={scale:1,translateX:0,translateY:0},this._uiHideTimer=null,this._uiHideDelay=1500,this._wheelSwipeAccum=0,this._wheelSwipeTimer=null,this._wheelMode=null,this._lastSwipeNavTime=0,this._lastWheelEventTime=0,this._lastWheelDeltaX=0,this._swipeModeLocked=!1,this._pendingSlideDir=0,this.touchStart=null,this._dragPointerId=null,this._dragLast={x:0,y:0},this._isPinching=!1,this.pointers=new Map,this._lastTouchTime=0,this._wheelSource=null,this._wheelSourceReset=null,this._lastWheelSampleTime=0,this._hasTrackpad=document.body?.classList.contains("using-trackpad")||!1;const t=localStorage.getItem(y);this.invertedScroll=t==="true",this.calibrationActive=!1,this.needsCalibration=t===null,this.calibrationSource=null,this._pendingCalibrationListener=null,this._init()}_init(){this._detectInputMethod(),this._injectStyles(),this._scanCollections(),this._createOverlay(),this.liveRegion=c("div",{"aria-live":"polite",style:{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0,0,0,0)",whiteSpace:"nowrap",border:"0"}}),this.nodes.shell.appendChild(this.liveRegion),this._bindGlobalListeners()}_detectInputMethod(){window.addEventListener("touchstart",()=>{this._lastTouchTime=performance.now(),this._setInputMode("touch")},{passive:!0}),window.addEventListener("wheel",t=>{performance.now()-(this._lastTouchTime||0)<400||this._determineWheelSource(t)},{passive:!0})}_determineWheelSource(t){if(!t)return this._wheelSource||"mouse";if(performance.now()-(this._lastTouchTime||0)<400)return this._wheelSource||"mouse";if(this._wheelSource==="trackpad")return"trackpad";const i=this._isTrackpadWheel(t),e=i?"trackpad":"mouse";return i&&(this._hasTrackpad=!0),e!==this._wheelSource&&this._setInputMode(i?"trackpad":"mouse"),this._wheelSource=e,e}_setInputMode(t){const s=document.body;s&&(s.classList.remove("using-touch","using-mouse","using-trackpad"),t==="touch"?s.classList.add("using-touch"):t==="trackpad"?(s.classList.add("using-trackpad"),this._hasTrackpad=!0):s.classList.add("using-mouse"))}_isTrackpadWheel(t){return!(!t||typeof t.deltaMode=="number"&&t.deltaMode!==0||Math.abs(t.deltaY)===0||!Number.isInteger(t.deltaY))}_checkCalibration(){if(!this.needsCalibration||this.calibrationActive)return;const t=()=>{this._showCalibration("trackpad")};if(this._hasTrackpad||document.body.classList.contains("using-trackpad")){t();return}const s=i=>{this._determineWheelSource(i)==="trackpad"&&(window.removeEventListener("wheel",s),this._pendingCalibrationListener=null,t())};window.addEventListener("wheel",s,{passive:!0}),this._pendingCalibrationListener=s}_showCalibration(t="trackpad"){if(t!=="trackpad"||this.calibrationActive)return;this._pendingCalibrationListener&&(window.removeEventListener("wheel",this._pendingCalibrationListener),this._pendingCalibrationListener=null),this.calibrationSource=t,this.calibrationActive=!0,this.calibrationAccum=0,this.calibrationStep=0,this.calibrationStartTime=Date.now();const s=c("div",{class:"spot-calibration"}),i=c("div",{class:"spot-calibration-content"}),e=c("h3",{},["Trackpad Setup"]),n=c("p",{},["Swipe down repeatedly to calibrate."]),o=c("div",{class:"trackpad-container"});o.innerHTML=`
        <div class="trackpad">
            <div class="finger swipe-down"></div>
        </div>
      `;const a=c("div",{class:"spot-progress-bar"}),r=c("div",{class:"spot-progress-value"});a.appendChild(r),i.appendChild(e),i.appendChild(n),i.appendChild(o),i.appendChild(a),s.appendChild(i),this.nodes.shell.appendChild(s),this.nodes.calibration=s,this.nodes.calibrationProgress=r,this.nodes.calibrationText=n,requestAnimationFrame(()=>{s.classList.add("visible")})}_handleCalibrationWheel(t){if(this.calibrationSource!=="trackpad"||!this._isTrackpadWheel(t))return;if(this.calibrationStartTime&&Date.now()-this.calibrationStartTime<400){t.preventDefault(),t.stopPropagation();return}if(t.preventDefault(),t.stopPropagation(),Math.abs(t.deltaX)>Math.abs(t.deltaY))return;this.calibrationAccum=(this.calibrationAccum||0)+t.deltaY;const i=Math.min(Math.abs(this.calibrationAccum)/80,1);if(this.nodes.calibrationProgress&&(this.nodes.calibrationProgress.style.width=`${i*100}%`),i>=1){if(this.calibrationStep===0){this.calibrationStep=1,this.calibrationAccum=0,this.calibrationStartTime=Date.now(),this.nodes.calibrationProgress&&(this.nodes.calibrationProgress.style.width="0%"),this.nodes.calibrationText&&(this.nodes.calibrationText.textContent="One more time...");return}const e=this.calibrationAccum<0;this.invertedScroll=e,localStorage.setItem(y,String(e)),this.needsCalibration=!1,this.calibrationCooldown=Date.now()+800,this.nodes.calibration.classList.remove("visible"),setTimeout(()=>{this.nodes.calibration&&(this.nodes.calibration.remove(),this.nodes.calibration=null,this.nodes.calibrationProgress=null,this.nodes.calibrationText=null),this.calibrationActive=!1,this.calibrationSource=null},300)}}_scanCollections(){const t=[];b("article").forEach(s=>{const i=b("img",s);i.length&&t.push({type:"article",el:s,imgs:i})}),b(".gallery").forEach(s=>{if(!t.some(i=>i.el===s)){const i=b("img",s);t.push({type:"gallery",el:s,imgs:i})}}),t.forEach((s,i)=>{const e=[];s.imgs.forEach((n,o)=>{const a=n.dataset.src||n.getAttribute("src")||n.currentSrc||null;if(!a)return;const r=n.closest("figure"),l=r?r.querySelector("figcaption"):null,h=l?l.textContent.trim():(n.getAttribute("data-caption")||n.getAttribute("alt")||"").trim();e.push({src:a,el:n,caption:h}),n.dataset.spotlightCollection=String(this.collections.length),n.dataset.spotlightIndex=String(e.length-1),n.style.cursor="zoom-in"}),e.length&&this.collections.push({id:`spot-${this._randId()}`,container:s.el,items:e})})}_randId(){return Math.random().toString(36).slice(2,9)}_createOverlay(){const t=c("div",{id:"spot-overlay","aria-hidden":"true",tabindex:"-1"}),s=c("div",{id:"spot-bg"}),i=c("div",{id:"spot-shell",role:"dialog","aria-modal":"true"}),e=c("div",{id:"spot-stage",class:"spot-stage"}),n=c("button",{id:"spot-prev",class:"spot-nav","aria-label":"Previous image","data-dir":"-1"});n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-compact-left" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="m13 20-3-8 3-8"/></svg>';const o=c("div",{id:"spot-canvas",class:"spot-canvas"}),a=c("div",{id:"spot-transform",class:"spot-transform"}),r=c("img",{id:"spot-img",draggable:"false"});a.appendChild(r),o.appendChild(a);const l=c("button",{id:"spot-next",class:"spot-nav","aria-label":"Next image","data-dir":"1"});l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-compact-right" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="m11 4 3 8-3 8"/></svg>',e.appendChild(n),e.appendChild(o),e.appendChild(l);const h=c("div",{id:"spot-ui",class:"spot-ui spot-ui-visible"}),u=c("div",{id:"spot-topbar",class:"spot-topbar"}),_=c("div",{id:"spot-counter",class:"spot-counter"}),p=c("div",{class:"spot-controls"}),m=c("button",{id:"spot-zoom-out",class:"spot-btn","aria-label":"Zoom out"});m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-zoom-out" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0m4 0h6m8 11-6-6"/></svg>';const w=c("button",{id:"spot-zoom-display",class:"spot-btn","aria-label":"Reset zoom"},["100%"]),f=c("button",{id:"spot-zoom-in",class:"spot-btn","aria-label":"Zoom in"});f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-zoom-in" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0m4 0h6m-3-3v6m11 8-6-6"/></svg>';const E=c("button",{id:"spot-fullscreen",class:"spot-btn","aria-label":"Toggle fullscreen"}),g=c("button",{id:"spot-close",class:"spot-btn","aria-label":"Close"});g.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-x" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="M18 6 6 18M6 6l12 12"/></svg>',p.appendChild(m),p.appendChild(w),p.appendChild(f),p.appendChild(E),p.appendChild(g),u.appendChild(_),u.appendChild(p);const T=c("div",{id:"spot-caption",class:"spot-caption"});h.appendChild(u),h.appendChild(T),i.appendChild(e),i.appendChild(h),t.appendChild(s),t.appendChild(i),document.body.appendChild(t),this.overlay=t,this.nodes={overlay:t,bg:s,shell:i,ui:h,closeBtn:g,zoomIn:f,zoomOut:m,zoomDisplay:w,fullscreenBtn:E,prevBtn:n,nextBtn:l,canvas:o,transform:a,imgNode:r,counter:_,caption:T},this._pointerOverUi=!1,this._pointerOverUiCount=0;const I=Array.from(t.querySelectorAll(".spot-btn")),M=[this.nodes.prevBtn,this.nodes.nextBtn,this.nodes.caption,u,...I].filter(Boolean),O=()=>{this._pointerOverUiCount=(this._pointerOverUiCount||0)+1,this._pointerOverUi=!0,this._showUiImmediate()},N=()=>{this._pointerOverUiCount=Math.max(0,(this._pointerOverUiCount||0)-1),this._pointerOverUiCount===0&&(this._pointerOverUi=!1,this._scheduleUiHide())};M.forEach(v=>{v.addEventListener("pointerenter",O),v.addEventListener("pointerleave",N)}),this.nodes.closeBtn.addEventListener("click",()=>this.close()),this.nodes.bg.addEventListener("click",()=>this.close()),this.nodes.prevBtn.addEventListener("click",()=>this.prev()),this.nodes.nextBtn.addEventListener("click",()=>this.next()),this.nodes.zoomIn.addEventListener("click",()=>this._zoomBy(1.2)),this.nodes.zoomOut.addEventListener("click",()=>this._zoomBy(1/1.2)),this.nodes.zoomDisplay.addEventListener("click",()=>this._resetZoom()),this.nodes.fullscreenBtn.addEventListener("click",()=>this._toggleFullscreen()),t.addEventListener("pointermove",()=>this._handleUserActivity()),t.addEventListener("pointerdown",()=>this._handleUserActivity()),t.addEventListener("touchstart",()=>this._handleUserActivity(),{passive:!0}),this._updateFullscreenButton(),t.addEventListener("wheel",v=>{this.state.open&&this._isPointerOverStage(v)&&v.preventDefault()},{passive:!1})}_isPointerOverStage(t){const s=this.nodes.canvas.getBoundingClientRect();return t.clientX>=s.left&&t.clientX<=s.right&&t.clientY>=s.top&&t.clientY<=s.bottom}_bindGlobalListeners(){window.addEventListener("keydown",e=>this._handleKeydown(e));const t=e=>{if(!this.state.open)return;const o=this._determineWheelSource(e)==="trackpad";if(this.calibrationActive){o&&this._handleCalibrationWheel(e);return}if(this.calibrationCooldown&&Date.now()<this.calibrationCooldown)return;if(!o){e.preventDefault(),this._handleUserActivity(),e.ctrlKey?this._handleWheelZoom(e,!1):this._handleMouseWheelNavigation(e.deltaY);return}if(o&&this.needsCalibration&&!this.calibrationActive){e.preventDefault(),this._showCalibration("trackpad");return}const a=Date.now(),r=a-(this._lastSwipeNavTime||0),l=a-(this._lastWheelEventTime||0);if(console.log(`[wheel] t=${a} dX=${e.deltaX.toFixed(1)} dY=${e.deltaY.toFixed(1)} mode=${this._wheelMode} locked=${this._swipeModeLocked} sinceNav=${r}ms sinceWheel=${l}ms accum=${this._wheelSwipeAccum}`),this._swipeModeLocked){const p=Math.abs(e.deltaX)>(this._lastWheelDeltaX||0)+5;r>=500&&(l>150||p)&&(console.log(`[wheel] UNLOCK: debounce passed and (pause detected ${l}ms or acceleration)`),this._swipeModeLocked=!1,this._wheelMode=null,this._wheelSwipeAccum=0)}this._lastWheelEventTime=a,this._lastWheelDeltaX=Math.abs(e.deltaX),this._handleUserActivity();const h=o?this._detectWheelMode(e):"zoom";e.preventDefault(),o&&h==="swipe"?this._handleSwipeWheel(e.deltaX):this._handleWheelZoom(e,o),this._scheduleWheelGestureReset()};this.nodes.canvas.addEventListener("wheel",t,{passive:!1}),this.nodes.overlay.addEventListener("wheel",e=>{this.calibrationActive&&this._handleCalibrationWheel(e)},{passive:!1}),this.nodes.imgNode.addEventListener("pointerdown",e=>{if(this.state.open&&(this._handleUserActivity(),!!e.isPrimary)){this._dragPointerId=e.pointerId,this._dragLast.x=e.clientX,this._dragLast.y=e.clientY,this._dragStart={x:e.clientX,y:e.clientY},this._isVerticalSwipe=!1;try{this.nodes.imgNode.setPointerCapture(e.pointerId)}catch{}}}),window.addEventListener("pointermove",e=>{if(this._dragPointerId!==e.pointerId)return;if(this._handleUserActivity(),this._isPinching){this._dragPointerId=null;return}if(!this._isVerticalSwipe&&this._dragStart&&e.pointerType==="touch"){const a=e.clientY-this._dragStart.y,r=e.clientX-this._dragStart.x;Math.abs(this.state.scale-(this.state.baseScale||1))<.1&&a>0&&Math.abs(a)>Math.abs(r)&&a>20&&(this._isVerticalSwipe=!0,this._swipeIntent=!0)}if(this._isVerticalSwipe){const a=e.clientY-this._dragLast.y;this.state.translateY+=a,this._dragLast.x=e.clientX,this._dragLast.y=e.clientY,this._startRenderLoop();return}if(e.pointerType==="touch"&&Math.abs(this.state.scale-(this.state.baseScale||1))<.1)return;const n=e.clientX-this._dragLast.x,o=e.clientY-this._dragLast.y;this._dragLast.x=e.clientX,this._dragLast.y=e.clientY,this.state.translateX+=n,this.state.translateY+=o,this._constrainAndSync(),this._startRenderLoop()}),window.addEventListener("pointerup",e=>{if(this._dragPointerId===e.pointerId){this._isVerticalSwipe&&(e.clientY-this._dragStart.y>100?this.close():(this.state.translateY=0,this._constrainAndSync(),this._startRenderLoop()),this._isVerticalSwipe=!1);try{this.nodes.imgNode.releasePointerCapture(e.pointerId)}catch{}this._dragPointerId=null}}),this.touchStart=null,this.nodes.canvas.addEventListener("touchstart",e=>{this.state.open&&(this._handleUserActivity(),e.touches.length===1?this.touchStart={x:e.touches[0].clientX,y:e.touches[0].clientY,t:Date.now()}:this.touchStart=null)},{passive:!0}),this.nodes.canvas.addEventListener("touchend",e=>this._handleTouchEnd(e),{passive:!0}),this._bindPinch(),new ResizeObserver(()=>{this.state.open&&(this._fitImageToViewport(),this._applyTransform({immediate:!0}))}).observe(this.nodes.canvas),document.addEventListener("fullscreenchange",()=>this._syncFullscreenState());let i=1;this.nodes.canvas.addEventListener("gesturestart",e=>{this.state.open&&(e.preventDefault(),!(this.pointers.size>0)&&(i=1,this._isPinching=!0))},{passive:!1}),this.nodes.canvas.addEventListener("gesturechange",e=>{if(!this.state.open||(e.preventDefault(),this.pointers.size>0))return;const n=e.scale/i;if(i=e.scale,n!==1){const o=1+(n-1)*1;this._zoomAtPoint(o,e.clientX,e.clientY)}},{passive:!1}),this.nodes.canvas.addEventListener("gestureend",()=>{this.pointers.size>0||(this._isPinching=!1)},{passive:!1})}_handleSwipeWheel(t){const s=Date.now();if(s-(this._lastSwipeNavTime||0)<500)return;let e=t;this.invertedScroll&&(e=-e);const n=20,o=this.state.baseScale||1;Math.abs(this.state.scale-o)>Math.max(.8,o*.5)||(this._wheelSwipeAccum+=e,this._wheelSwipeAccum>n?(this._lastSwipeNavTime=s,this._wheelSwipeAccum=0,this._wheelMode="zoom",this._swipeModeLocked=!0,this.next()):this._wheelSwipeAccum<-n&&(this._lastSwipeNavTime=s,this._wheelSwipeAccum=0,this._wheelMode="zoom",this._swipeModeLocked=!0,this.prev()))}_handleMouseWheelNavigation(t){const s=Date.now();s-(this._lastMouseWheelNav||0)<300||Math.abs(t)<2||(this._lastMouseWheelNav=s,t>0?this.next():this.prev())}_detectWheelMode(t){if(this._wheelMode)return this._wheelMode;if(t.ctrlKey)return this._wheelMode="zoom",this._wheelMode;const s=Math.abs(t.deltaX),i=Math.abs(t.deltaY),e=this.state.baseScale||1,n=Math.abs(this.state.scale-e)<=Math.max(.8,e*.5);if(s<1&&i<1)return"zoom";const o=s>i*.65&&s-i>1||i<10&&s>10;if(n&&o)this._wheelMode="swipe";else if(i>s)this._wheelMode="zoom";else return"zoom";return this._wheelMode}_handleWheelZoom(t,s){if(this._isPinching)return;if(t.ctrlKey){const e=-t.deltaY,o=.01*1,a=1+e*o;this._zoomAtPoint(a,t.clientX,t.clientY);return}let i=t.deltaY;s&&this.invertedScroll&&(i=-i),s&&Math.abs(i)>Math.abs(t.deltaX)&&Math.abs(i)>0&&(this._isVerticalSwipe=!0,this._swipeIntent=!0,this._trackpadSwipeToClose=!0,this.state.translateY+=i,this.state.translateY<0&&(this.state.translateY=0),this._startRenderLoop())}_scheduleWheelGestureReset(){clearTimeout(this._wheelSwipeTimer),this._wheelSwipeTimer=setTimeout(()=>this._endWheelGesture(),80)}_endWheelGesture(){this._wheelSwipeTimer&&(clearTimeout(this._wheelSwipeTimer),this._wheelSwipeTimer=null),this._isVerticalSwipe&&(this.state.translateY>100?this.close():(this.state.translateY=0,this._constrainAndSync(),this._startRenderLoop()),this._isVerticalSwipe=!1,this._trackpadSwipeToClose=!1),this._wheelSwipeAccum=0,this._swipeModeLocked||(this._wheelMode=null)}_handleUserActivity(){this.state.open&&(this._showUiImmediate(),this._scheduleUiHide())}_scheduleUiHide(){clearTimeout(this._uiHideTimer),this._uiHideTimer=setTimeout(()=>{this._pointerOverUi?this._scheduleUiHide():this._hideUi()},this._uiHideDelay)}_showUiImmediate(){this.nodes?.ui&&(this.nodes.ui.classList.add("spot-ui-visible"),this.nodes.ui.classList.remove("spot-ui-hidden"),this.overlay&&this.overlay.classList.remove("spot-nav-hidden"))}_hideUi(){this.nodes?.ui&&(this.nodes.ui.classList.add("spot-ui-hidden"),this.nodes.ui.classList.remove("spot-ui-visible"),this.overlay&&this.overlay.classList.add("spot-nav-hidden"))}_toggleFullscreen(){this._handleUserActivity(),this.state.fullscreen?this._exitFullscreen():this._enterFullscreen()}_enterFullscreen(){const t=this.overlay;if(!(!t||document.fullscreenElement===t)){if(t.requestFullscreen){const s=t.requestFullscreen();s&&typeof s.catch=="function"&&s.catch(()=>{})}this._syncFullscreenState()}}_exitFullscreen(){if(document.fullscreenElement&&document.exitFullscreen){const t=document.exitFullscreen();t&&typeof t.catch=="function"&&t.catch(()=>{})}this._syncFullscreenState()}_syncFullscreenState(){const t=document.fullscreenElement===this.overlay;this.state.fullscreen=!!t,this._updateFullscreenButton()}_updateFullscreenButton(){const t=this.nodes?.fullscreenBtn;t&&(t.innerHTML=this.state.fullscreen?C:L,t.setAttribute("aria-label",this.state.fullscreen?"Exit fullscreen":"Enter fullscreen"),t.setAttribute("aria-pressed",String(this.state.fullscreen)))}_animateSlide(t,s){this._handleUserActivity(),this._pendingSlideDir=t||0,typeof s=="function"&&s()}_playSlideIn(t){const s=this.nodes?.imgNode;if(!s)return;const i=t||0;s.style.transition="none",i?(s.style.transform=`translateX(${i*60}px) scale(0.96)`,s.style.opacity="0"):(s.style.transform="translateX(0) scale(1)",s.style.opacity="1"),requestAnimationFrame(()=>{s.style.transition="transform 650ms cubic-bezier(0.3, 1, 0.3, 1), opacity 400ms ease",s.style.transform="translateX(0) scale(1)",s.style.opacity="1";const e=()=>{s.style.transition="",s.style.transform="",s.removeEventListener("transitionend",e)};s.addEventListener("transitionend",e,{once:!0})})}_bindPinch(){let t=0;const s=n=>{if(this.state.open&&(this._handleUserActivity(),this._swipeIntent=!1,this._trackpadSwipeToClose=!1,this.pointers.set(n.pointerId,n),this.pointers.size===2)){this._isPinching=!0;const[o,a]=Array.from(this.pointers.values());t=Math.hypot(a.clientX-o.clientX,a.clientY-o.clientY)}},i=n=>{if(this.pointers.has(n.pointerId)){if(!this.state.open){this.pointers.clear(),this._isPinching=!1;return}if(this._handleUserActivity(),this.pointers.set(n.pointerId,n),this.pointers.size===2){const[o,a]=Array.from(this.pointers.values()),r=Math.hypot(a.clientX-o.clientX,a.clientY-o.clientY);if(t>0){const l=r/t;if(t=r,l!==1){const h=n.pointerType==="touch"?1.1:1,u=1+(l-1)*h,_=(o.clientX+a.clientX)*.5,p=(o.clientY+a.clientY)*.5;this._zoomAtPoint(u,_,p)}}}}},e=n=>{this.pointers.delete(n.pointerId),this.pointers.size<2&&(this._isPinching=!1,t=0)};this.nodes.canvas.addEventListener("pointerdown",s),window.addEventListener("pointermove",i),window.addEventListener("pointerup",e),window.addEventListener("pointercancel",e)}openCollection(t,s=0){this.collections[t]&&(this.state.open=!0,this.state.collectionIndex=t,this.state.itemIndex=s,this._handleUserActivity(),this._showOverlay(),this._checkCalibration(),this._loadItem())}_showOverlay(){this.overlay.style.display="block",this._lastFocused=document.activeElement,requestAnimationFrame(()=>{this.overlay.classList.add("spot-open"),this.overlay.setAttribute("aria-hidden","false"),document.documentElement.style.overflow="hidden",this._showUiImmediate(),this._scheduleUiHide(),this.nodes.shell.focus()})}close(){this.state.open&&(this.overlay.classList.remove("spot-open"),this.overlay.setAttribute("aria-hidden","true"),document.documentElement.style.overflow="",this.state.open=!1,this.state.fullscreen=!1,this._exitFullscreen(),this._updateFullscreenButton(),clearTimeout(this._uiHideTimer),clearTimeout(this._wheelSwipeTimer),this._wheelSwipeAccum=0,this._wheelMode=null,this._lastSwipeNavTime=0,this._swipeModeLocked=!1,this._lastWheelDeltaX=0,this._pendingSlideDir=0,this._hideUi(),this._pendingCalibrationListener&&(window.removeEventListener("wheel",this._pendingCalibrationListener),this._pendingCalibrationListener=null),this.calibrationActive&&this.nodes.calibration&&(this.nodes.calibration.remove(),this.nodes.calibration=null,this.nodes.calibrationProgress=null,this.nodes.calibrationText=null,this.calibrationActive=!1,this.calibrationSource=null),setTimeout(()=>{this.state.open||(this.overlay.style.display="none"),this._lastFocused&&this._lastFocused.focus()},220))}prev(){const t=this.collections[this.state.collectionIndex];t&&(this.state.itemIndex=(this.state.itemIndex-1+t.items.length)%t.items.length,this._animateSlide(-1,()=>this._loadItem()))}next(){const t=this.collections[this.state.collectionIndex];t&&(this.state.itemIndex=(this.state.itemIndex+1)%t.items.length,this._animateSlide(1,()=>this._loadItem()))}_loadItem(){const t=this.collections[this.state.collectionIndex];if(!t)return;const s=t.items[this.state.itemIndex];if(!s)return;const i=this._pendingSlideDir||0;this._pendingSlideDir=0,this._resetRenderState(),this.nodes.imgNode.style.opacity="0",this.nodes.imgNode.src="",this.nodes.counter.textContent=`${this.state.itemIndex+1} / ${t.items.length}`,this._updateCaption(s.caption),this.liveRegion&&(this.liveRegion.textContent=`Image ${this.state.itemIndex+1} of ${t.items.length}${s.caption?": "+s.caption:""}`);const e=this.nodes.imgNode;e.onload=null,e.onerror=null,e.style.opacity="0",e.src="",e.onload=()=>{requestAnimationFrame(()=>{this._fitImageToViewport(),this._applyTransform({immediate:!0}),this._playSlideIn(i)})},e.onerror=()=>{e.src="",this._updateCaption("Failed to load image"),e.style.opacity="1"},e.src=s.src,/\.svg($|\?)/i.test(s.src)?e.classList.add("spot-svg"):e.classList.remove("spot-svg"),e.complete&&e.naturalWidth&&e.onload?.()}_updateCaption(t){if(!this.nodes||!this.nodes.caption)return;const s=(t||"").trim();s?(this.nodes.caption.textContent=s,this.nodes.caption.classList.remove("spot-caption-empty"),this.nodes.caption.style.display=""):(this.nodes.caption.textContent="",this.nodes.caption.classList.add("spot-caption-empty"),this.nodes.caption.style.display="none")}_resetRenderState(){this.state.scale=1,this.state.baseScale=1,this.state.translateX=0,this.state.translateY=0,this.renderState.scale=1,this.renderState.translateX=0,this.renderState.translateY=0,this._renderActive=!1,this.nodes.bg&&(this.nodes.bg.style.opacity=""),this.nodes.ui&&(this.nodes.ui.style.opacity=""),this.nodes.prevBtn&&(this.nodes.prevBtn.style.opacity=""),this.nodes.nextBtn&&(this.nodes.nextBtn.style.opacity=""),this.nodes.imgNode&&(this.nodes.imgNode.style.opacity=""),this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=null)}_startRenderLoop(){this._rafId||(this._renderActive=!0,this._lastRenderTime=Date.now(),this._renderLoop())}_renderLoop(){if(!this._renderActive||!this.state.open){this._rafId=null;return}const t=Date.now(),e=Math.min(t-(this._lastRenderTime||t),60)/1e3;this._lastRenderTime=t;const{scale:n,translateX:o,translateY:a}=this.state,r=this.renderState,l=1-Math.exp(-15*e);if(r.scale+=(n-r.scale)*l,r.translateX+=(o-r.translateX)*l,r.translateY+=(a-r.translateY)*l,this._checkConvergence(n,o,a,r),this.nodes.transform){this.nodes.transform.style.transition="none",this.nodes.transform.style.transform=`translate(${r.translateX}px, ${r.translateY}px) scale(${r.scale})`,this._updateZoomDisplay(r.scale),this._updateSwipeAnimation(r.translateY);const h=this.nodes.imgNode;h.style.cursor=Math.abs(r.scale-(this.state.baseScale||1))>.02||Math.abs(r.translateX)>1||Math.abs(r.translateY)>1?"grab":"zoom-out"}this._renderActive?this._rafId=requestAnimationFrame(()=>this._renderLoop()):this._rafId=null}_updateSwipeAnimation(t){const i=Math.abs(this.state.scale-(this.state.baseScale||1))<.1||this._trackpadSwipeToClose,e=[this.nodes.bg,this.nodes.ui,this.nodes.prevBtn,this.nodes.nextBtn,this.nodes.imgNode];if(t>0&&this.state.open&&i&&this._swipeIntent){const a=1-Math.min(1,Math.abs(t)/150);e.forEach(r=>{r&&(r.style.opacity=String(a))})}else e.forEach(n=>{n&&(n.style.opacity="")})}_checkConvergence(t,s,i,e){Math.abs(t-e.scale)<.001&&Math.abs(s-e.translateX)<.1&&Math.abs(i-e.translateY)<.1&&(e.scale=t,e.translateX=s,e.translateY=i,this._renderActive=!1,Math.abs(i)<1&&(this._swipeIntent=!1))}_fitImageToViewport(){const t=this.nodes?.imgNode;if(!t)return;const s=Math.max(window.innerWidth,1),i=Math.max(window.innerHeight,1),e=t.naturalWidth||t.width||t.clientWidth,n=t.naturalHeight||t.height||t.clientHeight;if(!e||!n)return;const o=s/e,a=i/n,r=s>=i;let l=1;if(r){const h=e<=s,u=n<=i;h||u?l=1:l=a,l=Math.min(l,1)}else l=Math.min(o,a);l=Math.min(8,Math.max(.05,l)),this.state.baseScale=l,this.state.scale=l,this.state.translateX=0,this.state.translateY=0,this.renderState.scale=l,this.renderState.translateX=0,this.renderState.translateY=0}_applyTransform(t={}){const s=t.immediate||!this.state.open;if(!this.nodes||!this.nodes.transform)return;const{scale:i,translateX:e,translateY:n}=this.state,o=this.nodes.transform;s?o.style.transition="none":o.style.transition="",o.style.transform=`translate(${e}px, ${n}px) scale(${i})`,this._updateZoomDisplay(i);const a=this.nodes.imgNode;a.style.cursor=Math.abs(i-(this.state.baseScale||1))>.02||Math.abs(e)>1||Math.abs(n)>1?"grab":"zoom-out"}_updateZoomDisplay(t){if(!this.nodes||!this.nodes.zoomDisplay)return;const s=Math.round((t||1)*100);this.nodes.zoomDisplay.textContent=`${s}%`,this.nodes.zoomDisplay.title=`Reset zoom (${s}%)`}_zoomBy(t){this._handleUserActivity(),this.state.scale=Math.min(8,Math.max(.2,this.state.scale*t)),this._startRenderLoop()}_resetZoom(){this._handleUserActivity(),this.state.scale=this.state.baseScale||1,this.state.translateX=0,this.state.translateY=0,this._startRenderLoop()}_constrainAndSync(){const{naturalWidth:t,naturalHeight:s}=this.nodes.imgNode,{clientWidth:i,clientHeight:e}=this.nodes.canvas,n=t*this.state.scale,o=s*this.state.scale,a=.05,r=i*.5+n*(.5-a),l=e*.5+o*(.5-a);this.state.translateX=Math.min(r,Math.max(-r,this.state.translateX)),this.state.translateY=Math.min(l,Math.max(-l,this.state.translateY))}_zoomAtPoint(t,s,i){this._handleUserActivity(),this._swipeIntent=!1,this._trackpadSwipeToClose=!1;const e=(this.nodes.transform||this.nodes.imgNode).getBoundingClientRect(),n=s-e.left,o=i-e.top,a=n/e.width,r=o/e.height,l=this.state.scale,h=Math.min(8,Math.max(.2,l*t)),{clientWidth:u,clientHeight:_}=this.nodes.canvas,{naturalWidth:p,naturalHeight:m}=this.nodes.imgNode,w=p*h,f=m*h,E=s-u*.5-w*(a-.5),g=i-_*.5-f*(r-.5);this.state.translateX=E,this.state.translateY=g,this.state.scale=h,this._constrainAndSync(),this._startRenderLoop()}attachImage(t,s,i){t.dataset.spotlightCollection=String(s),t.dataset.spotlightIndex=String(i),t.addEventListener("click",e=>{e.preventDefault(),this.openCollection(s,i)})}_injectStyles(){if(document.getElementById("spotlight-styles"))return;const t=`@keyframes swipeDown{0%{top:40px;opacity:0;transform:translateX(-50%) scale(.8)}10%{opacity:1;transform:translateX(-50%) scale(1)}60%{top:180px;opacity:1;transform:translateX(-50%) scale(1);box-shadow:0 2px 10px rgba(0,122,255,.4)}75%{top:180px;opacity:0;transform:translateX(-50%) scale(1.5);box-shadow:0 0 0 20px transparent}to{top:180px;opacity:0}}:root{--spot-bg:rgba(6,6,8,1);--spot-ui-bg:rgba(20,20,24,0.78);--spot-ui-fg:rgba(255,255,255,0.95);--spot-muted:rgba(255,255,255,0.74);--spot-btn-bg:rgba(255,255,255,0.08);--spot-btn-border:rgba(255,255,255,0.1);--spot-shadow:0 10px 40px rgba(0,0,0,0.45);--spot-anim:300ms cubic-bezier(.22,.9,.35,1);--spot-font:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif}@media (prefers-color-scheme:light){:root{--spot-bg:rgba(250,250,252,1);--spot-ui-bg:rgba(255,255,255,0.8);--spot-ui-fg:rgba(17,17,20,0.92);--spot-muted:rgba(17,17,20,0.7);--spot-btn-bg:rgba(0,0,0,0.05);--spot-btn-border:rgba(0,0,0,0.1);--spot-shadow:0 2px 80px rgba(0,0,0,0.15)}#spot-overlay .spot-nav{background:rgba(255,255,255,.92);border-color:rgba(0,0,0,.06);box-shadow:0 6px 18px rgba(10,10,10,.06)}#spot-overlay .spot-nav:hover{background:rgba(245,245,245,.98)}}#spot-overlay{display:none;position:fixed;inset:0;z-index:2147483646;font-family:var(--spot-font);-webkit-font-smoothing:antialiased;opacity:0;transition:opacity var(--spot-anim);touch-action:none}#spot-overlay,#spot-overlay *{-webkit-user-select:none;user-select:none}#spot-overlay.spot-open{pointer-events:auto;opacity:1}#spot-bg,.spot-nav svg{transition:opacity var(--spot-anim)}#spot-bg,#spot-shell{position:fixed;inset:0;opacity:0}#spot-bg{background:var(--spot-bg)}#spot-shell{pointer-events:none;transform:scale(.996);transition:opacity var(--spot-anim),transform var(--spot-anim)}#spot-overlay.spot-open #spot-shell{opacity:1;transform:scale(1)}#spot-overlay.spot-open #spot-bg,.spot-controls .spot-btn:hover,.spot-nav:hover svg{opacity:1}#spot-canvas,#spot-stage{inset:0;display:flex;align-items:center;justify-content:center}#spot-stage{position:fixed;pointer-events:none;z-index:2147483645}#spot-canvas{position:absolute;overflow:hidden;pointer-events:auto}#spot-transform{will-change:transform;touch-action:none;transform-origin:center center;cursor:grab;transition:transform var(--spot-anim)}#spot-transform img{display:block;width:auto;height:auto;max-width:none;max-height:none;object-fit:contain;user-select:none;-webkit-user-drag:none;pointer-events:auto;transition:opacity 180ms ease}#spot-transform img.spot-svg{width:100%;height:auto;max-width:100vw;max-height:100vh}.spot-caption,.spot-nav,.spot-topbar{pointer-events:auto;color:var(--spot-ui-fg);box-shadow:var(--spot-shadow);backdrop-filter:blur(0)}.spot-nav{position:absolute;top:50%;transform:translateY(-50%);width:50px;height:50px;border-radius:50%;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.12);display:flex;align-items:center;justify-content:center;font-size:0;cursor:pointer;opacity:1;transition:background var(--spot-anim),transform var(--spot-anim),opacity var(--spot-anim),backdrop-filter var(--spot-anim);z-index:2147483650}#spot-overlay.spot-open .spot-nav{backdrop-filter:blur(6px)}.spot-nav svg{width:30px;height:30px;opacity:.5}.spot-nav:hover{background:rgba(0,0,0,.45)}.spot-nav[data-dir="-1"]{left:22px;--nav-offset:-40px}.spot-nav[data-dir="1"]{right:22px;--nav-offset:40px}#spot-ui{position:fixed;inset:0;pointer-events:none;display:flex;flex-direction:column;justify-content:space-between;gap:20px;z-index:2147483647}.spot-caption,.spot-topbar{background:var(--spot-ui-bg);transition:backdrop-filter var(--spot-anim)}#spot-overlay.spot-open .spot-caption,#spot-overlay.spot-open .spot-topbar{backdrop-filter:blur(18px)}.spot-controls,.spot-topbar{display:flex;align-items:center}.spot-topbar{gap:18px;height:50px}.spot-controls{margin-left:auto;gap:10px}.spot-controls svg{width:21px;height:21px}.spot-controls .spot-btn{opacity:.5;transition:opacity var(--spot-anim),background 150ms ease;will-change:opacity}.spot-btn,.spot-counter{height:50px;color:var(--spot-ui-fg);display:flex;justify-content:center;font-weight:600}.spot-counter{font-size:15px;letter-spacing:.08em;opacity:.5;min-width:10ch;max-width:12ch;padding:15px;box-sizing:border-box;align-items:flex-end;white-space:nowrap;font-variant-numeric:tabular-nums;-webkit-font-feature-settings:"tnum"1;font-feature-settings:"tnum"1}.spot-btn{width:50px;border-radius:6px;border:0;background:0 0;align-items:center;font-size:16px;cursor:pointer;transition:background 150ms ease}.spot-btn:active{transform:none}#spot-caption{padding:14px 18px;font-size:21px;line-height:1.45;color:var(--spot-muted)}#spot-caption.spot-caption-empty{opacity:0;pointer-events:none}#spot-overlay.spot-nav-hidden .spot-nav{opacity:0;pointer-events:none;transform:translateY(-50%) translateX(var(--nav-offset))}#spot-ui .spot-caption,#spot-ui .spot-topbar{transition:opacity var(--spot-anim),transform var(--spot-anim);will-change:opacity,transform}#spot-ui.spot-ui-hidden .spot-topbar{opacity:0;transform:translateY(-18px);pointer-events:none}#spot-ui.spot-ui-hidden .spot-caption{opacity:0;transform:translateY(18px);pointer-events:none}#spot-ui.spot-ui-visible .spot-caption,#spot-ui.spot-ui-visible .spot-topbar{opacity:1;transform:translateY(0)}@media (max-width:600px){#spot-ui{flex-direction:column-reverse}#spot-fullscreen{display:none}.spot-topbar{gap:10px;height:75px}.spot-controls svg{width:25px;height:25px}#spot-caption{font-size:16px}.spot-nav{display:none}.spot-nav[data-dir="-1"]{left:10px;--nav-offset:-20px}.spot-nav[data-dir="1"]{right:10px;--nav-offset:20px}}@media (prefers-reduced-motion:reduce){:root{--spot-anim:0s}#spot-transform{transition:none}}.spot-calibration{position:fixed;inset:0;z-index:2147483660;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s ease}.spot-calibration.visible{opacity:1;pointer-events:auto}.spot-calibration-content{background:var(--spot-ui-bg);color:var(--spot-ui-fg);padding:40px;border-radius:12px;text-align:center;max-width:400px;box-shadow:var(--spot-shadow);backdrop-filter:blur(10px)}.spot-calibration h3{margin:0 0 15px;font-size:20px}.spot-calibration p{margin:0 0 30px;opacity:.8;line-height:1.5}.trackpad-container{transform:scale(.6);margin:0 auto;width:400px}.trackpad{width:400px;height:250px;background:#fff;border-radius:20px;border:2px solid #ccc;position:relative;overflow:hidden;box-shadow:0 10px 15px -3px rgba(0,0,0,.1);margin:0 auto}.finger{width:32px;height:32px;background:#007aff;box-shadow:0 2px 10px rgba(0,122,255,.4);border-radius:50%;position:absolute}.spot-progress-bar{width:100%;height:6px;background:rgba(128,128,128,.2);border-radius:3px;margin-top:25px;overflow:hidden}.spot-progress-value{width:0%;height:100%;background:#007aff;transition:width .1s linear}.finger.swipe-down{left:50%;transform:translateX(-50%);animation:swipeDown 2s cubic-bezier(.4,0,.2,1) infinite}`,s=c("style",{id:"spotlight-styles",type:"text/css"});s.appendChild(document.createTextNode(t)),document.head.appendChild(s)}_handleKeydown(t){if(!this.state.open)return;this._handleUserActivity();const s=t.code||"",i=t.key||"",e=String(i).toLowerCase();if(s==="Escape"||i==="Escape"||i==="Esc"){this.close();return}this._handleNavigation(s,i,e)||this._handleZoom(s,i)||(this._isResetZoomKey(s,i)?this._resetZoom():(s==="KeyF"||e==="f")&&this._toggleFullscreen())}_handleNavigation(t,s,i){return this._isNextKey(t,s,i)?(this.next(),!0):this._isPrevKey(t,s,i)?(this.prev(),!0):!1}_handleZoom(t,s){return this._isZoomInKey(t,s)?(this._zoomBy(1.2),!0):this._isZoomOutKey(t,s)?(this._zoomBy(1/1.2),!0):!1}_isNextKey(t,s,i){return t==="ArrowRight"||t==="KeyL"||s==="ArrowRight"||i==="l"||s==="Right"}_isPrevKey(t,s,i){return t==="ArrowLeft"||t==="KeyH"||s==="ArrowLeft"||i==="h"||s==="Left"}_isZoomInKey(t,s){return t==="Equal"||t==="NumpadAdd"||s==="+"||s==="="}_isZoomOutKey(t,s){return t==="Minus"||t==="NumpadSubtract"||s==="-"||s==="_"}_isResetZoomKey(t,s){return t==="Digit0"||t==="Numpad0"||s==="0"||s===")"}_handleTouchEnd(t){if(!this.state.open||!this.touchStart)return;this._handleUserActivity();const s=t.changedTouches&&t.changedTouches[0]&&t.changedTouches[0].clientX||0,i=t.changedTouches&&t.changedTouches[0]&&t.changedTouches[0].clientY||0,e=s-this.touchStart.x,n=i-this.touchStart.y,o=Date.now()-this.touchStart.t;this.touchStart=null,this._isValidSwipe(e,n,o)&&(e<0?this.next():this.prev())}_isValidSwipe(t,s,i){const e=Math.abs(t),n=Math.abs(s);return e>n&&e>20&&i<500&&Math.abs(this.state.scale-(this.state.baseScale||1))<.25}}function x(){if(window.__spotlight_instance)return window.__spotlight_instance;const d=new A;return window.__spotlight_instance=d,d}const S=x;window.addEventListener("click",d=>{const t=d.target.closest("img");if(!t||!t.closest("article, .gallery"))return;d.preventDefault();const i=x(),e=parseInt(t.dataset.spotlightCollection||"0",10),n=parseInt(t.dataset.spotlightIndex||"0",10);i.openCollection(e,n)}),window.Spotlight={get instance(){return window.__spotlight_instance||null},open:(d=0,t=0)=>{window.__spotlight_instance||S(),window.__spotlight_instance.openCollection(d,t)},rescan:()=>{const d=window.__spotlight_instance||S();try{d.overlay&&d.overlay.parentNode&&d.overlay.parentNode.removeChild(d.overlay)}catch{}return delete window.__spotlight_instance,S()}}})()})();
