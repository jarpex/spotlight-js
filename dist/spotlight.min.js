/*!
 * Spotlight JS v1.0.1
 * Copyright (c) 2025 Anastasia Shebalkina
 * Licensed under the MIT License (see LICENSE)
 *
 * Includes Tabler Icons (https://tabler.io/icons), MIT License
 * Copyright (c) 2020-2025 Tabler Icons Authors (see LICENSE.tabler-icons)
 */
(function(){"use strict";(()=>{const f=(c,t=document)=>Array.from(t.querySelectorAll(c)),l=(c,t={},e=[])=>{const i=document.createElement(c);return Object.entries(t).forEach(([s,n])=>{s==="style"?Object.assign(i.style,n):s.startsWith("on")&&typeof n=="function"?i.addEventListener(s.slice(2),n):s==="dataset"?Object.entries(n).forEach(([o,a])=>i.dataset[o]=a):i.setAttribute(s,n)}),e.forEach(s=>typeof s=="string"?i.appendChild(document.createTextNode(s)):i.appendChild(s)),i},L=`
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-arrows-maximize" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="M16 4h4v4m-6 2 6-6M8 20H4v-4m0 4 6-6m6 6h4v-4m-6-2 6 6M8 4H4v4m0-4 6 6"/></svg>
  `,A=`
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-arrows-minimize" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="M5 9h4V5M3 3l6 6m-4 6h4v4m-6 2 6-6m10-6h-4V5m0 4 6-6m-2 12h-4v4m0-4 6 6"/></svg>
  `;class C{constructor(){this.collections=[],this.overlay=null,this.state={open:!1,collectionIndex:0,itemIndex:0,scale:1,baseScale:1,translateX:0,translateY:0,fullscreen:!1},this._rafId=null,this._renderActive=!1,this.renderState={scale:1,translateX:0,translateY:0},this._uiHideTimer=null,this._uiHideDelay=1500,this._wheelSwipeAccum=0,this._wheelSwipeTimer=null,this._wheelMode=null,this._swipeActive=!1,this._swipeDirection=0,this._pendingSlideDir=0,this.touchStart=null,this._init()}_init(){this._injectStyles(),this._scanCollections(),this._createOverlay(),this.liveRegion=l("div",{"aria-live":"polite",style:{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0,0,0,0)",whiteSpace:"nowrap",border:"0"}}),this.nodes.shell.appendChild(this.liveRegion),this._bindGlobalListeners()}_scanCollections(){const t=[];f("article").forEach(e=>{const i=f("img",e);i.length&&t.push({type:"article",el:e,imgs:i})}),f(".gallery").forEach(e=>{if(!t.some(i=>i.el===e)){const i=f("img",e);t.push({type:"gallery",el:e,imgs:i})}}),t.forEach((e,i)=>{const s=[];e.imgs.forEach((n,o)=>{const a=n.dataset.src||n.getAttribute("src")||n.currentSrc||null;if(!a)return;const h=n.closest("figure"),r=h?h.querySelector("figcaption"):null,d=r?r.textContent.trim():(n.getAttribute("data-caption")||n.getAttribute("alt")||"").trim();s.push({src:a,el:n,caption:d}),n.dataset.spotlightCollection=String(this.collections.length),n.dataset.spotlightIndex=String(s.length-1),n.style.cursor="zoom-in"}),s.length&&this.collections.push({id:`spot-${this._randId()}`,container:e.el,items:s})})}_randId(){return Math.random().toString(36).slice(2,9)}_createOverlay(){const t=l("div",{id:"spot-overlay","aria-hidden":"true",tabindex:"-1"}),e=l("div",{id:"spot-bg"}),i=l("div",{id:"spot-shell",role:"dialog","aria-modal":"true"}),s=l("div",{id:"spot-stage",class:"spot-stage"}),n=l("button",{id:"spot-prev",class:"spot-nav","aria-label":"Previous image","data-dir":"-1"});n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-compact-left" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="m13 20-3-8 3-8"/></svg>';const o=l("div",{id:"spot-canvas",class:"spot-canvas"}),a=l("div",{id:"spot-transform",class:"spot-transform"}),h=l("img",{id:"spot-img",draggable:"false"});a.appendChild(h),o.appendChild(a);const r=l("button",{id:"spot-next",class:"spot-nav","aria-label":"Next image","data-dir":"1"});r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-compact-right" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="m11 4 3 8-3 8"/></svg>',s.appendChild(n),s.appendChild(o),s.appendChild(r);const d=l("div",{id:"spot-ui",class:"spot-ui spot-ui-visible"}),p=l("div",{id:"spot-topbar",class:"spot-topbar"}),m=l("div",{id:"spot-counter",class:"spot-counter"}),u=l("div",{class:"spot-controls"}),_=l("button",{id:"spot-zoom-out",class:"spot-btn","aria-label":"Zoom out"});_.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-zoom-out" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0m4 0h6m8 11-6-6"/></svg>';const E=l("button",{id:"spot-zoom-display",class:"spot-btn","aria-label":"Reset zoom"},["100%"]),w=l("button",{id:"spot-zoom-in",class:"spot-btn","aria-label":"Zoom in"});w.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-zoom-in" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0m4 0h6m-3-3v6m11 8-6-6"/></svg>';const S=l("button",{id:"spot-fullscreen",class:"spot-btn","aria-label":"Toggle fullscreen"}),y=l("button",{id:"spot-close",class:"spot-btn","aria-label":"Close"});y.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-x" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="M18 6 6 18M6 6l12 12"/></svg>',u.appendChild(_),u.appendChild(E),u.appendChild(w),u.appendChild(S),u.appendChild(y),p.appendChild(m),p.appendChild(u);const x=l("div",{id:"spot-caption",class:"spot-caption"});d.appendChild(p),d.appendChild(x),i.appendChild(s),i.appendChild(d),t.appendChild(e),t.appendChild(i),document.body.appendChild(t),this.overlay=t,this.nodes={overlay:t,bg:e,shell:i,ui:d,closeBtn:y,zoomIn:w,zoomOut:_,zoomDisplay:E,fullscreenBtn:S,prevBtn:n,nextBtn:r,canvas:o,transform:a,imgNode:h,counter:m,caption:x},this._pointerOverUi=!1,this._pointerOverUiCount=0;const T=Array.from(t.querySelectorAll(".spot-btn")),I=[this.nodes.prevBtn,this.nodes.nextBtn,this.nodes.caption,p,...T].filter(Boolean),M=()=>{this._pointerOverUiCount=(this._pointerOverUiCount||0)+1,this._pointerOverUi=!0,this._showUiImmediate()},O=()=>{this._pointerOverUiCount=Math.max(0,(this._pointerOverUiCount||0)-1),this._pointerOverUiCount===0&&(this._pointerOverUi=!1,this._scheduleUiHide())};I.forEach(v=>{v.addEventListener("pointerenter",M),v.addEventListener("pointerleave",O)}),this.nodes.closeBtn.addEventListener("click",()=>this.close()),this.nodes.bg.addEventListener("click",()=>this.close()),this.nodes.prevBtn.addEventListener("click",()=>this.prev()),this.nodes.nextBtn.addEventListener("click",()=>this.next()),this.nodes.zoomIn.addEventListener("click",()=>this._zoomBy(1.2)),this.nodes.zoomOut.addEventListener("click",()=>this._zoomBy(1/1.2)),this.nodes.zoomDisplay.addEventListener("click",()=>this._resetZoom()),this.nodes.fullscreenBtn.addEventListener("click",()=>this._toggleFullscreen()),t.addEventListener("pointermove",()=>this._handleUserActivity()),t.addEventListener("pointerdown",()=>this._handleUserActivity()),t.addEventListener("touchstart",()=>this._handleUserActivity(),{passive:!0}),this._updateFullscreenButton(),t.addEventListener("wheel",v=>{this.state.open&&this._isPointerOverStage(v)&&v.preventDefault()},{passive:!1})}_isPointerOverStage(t){const e=this.nodes.canvas.getBoundingClientRect();return t.clientX>=e.left&&t.clientX<=e.right&&t.clientY>=e.top&&t.clientY<=e.bottom}_bindGlobalListeners(){window.addEventListener("keydown",s=>this._handleKeydown(s)),this.nodes.canvas.addEventListener("wheel",s=>{if(!this.state.open)return;this._handleUserActivity(),this._detectWheelMode(s)==="swipe"?(s.preventDefault(),this._handleSwipeWheel(s.deltaX)):(s.preventDefault(),this._handleWheelZoom(s)),this._scheduleWheelGestureReset()},{passive:!1});let t=!1;const e={x:0,y:0};this.nodes.imgNode.addEventListener("pointerdown",s=>{if(this.state.open&&(this._handleUserActivity(),!!s.isPrimary)){t=!0,e.x=s.clientX,e.y=s.clientY;try{this.nodes.imgNode.setPointerCapture(s.pointerId)}catch{}}}),window.addEventListener("pointermove",s=>{if(!t||(this._handleUserActivity(),s.pointerType==="touch"&&Math.abs(this.state.scale-(this.state.baseScale||1))<.1))return;const n=s.clientX-e.x,o=s.clientY-e.y;e.x=s.clientX,e.y=s.clientY,this.state.translateX+=n,this.state.translateY+=o,this._startRenderLoop()}),window.addEventListener("pointerup",s=>{if(t)try{this.nodes.imgNode.releasePointerCapture(s.pointerId)}catch{}t=!1}),this.touchStart=null,this.nodes.canvas.addEventListener("touchstart",s=>{this.state.open&&(this._handleUserActivity(),s.touches.length===1?this.touchStart={x:s.touches[0].clientX,y:s.touches[0].clientY,t:Date.now()}:this.touchStart=null)},{passive:!0}),this.nodes.canvas.addEventListener("touchend",s=>this._handleTouchEnd(s),{passive:!0}),this._bindPinch(),new ResizeObserver(()=>{this.state.open&&(this._fitImageToViewport(),this._applyTransform({immediate:!0}))}).observe(this.nodes.canvas),document.addEventListener("fullscreenchange",()=>this._syncFullscreenState())}_handleSwipeWheel(t){this._handleUserActivity();const e=45,i=this.state.baseScale||1;if(!(Math.abs(this.state.scale-i)>Math.max(.8,i*.5))){if(this._swipeActive){const s=t===0?0:t>0?1:-1,n=Math.abs(t)<1.5;if(s&&s!==this._swipeDirection||n)this._endWheelGesture();else return}this._wheelSwipeAccum+=t,this._wheelSwipeAccum>e?this._commitSwipeNavigation(1):this._wheelSwipeAccum<-e&&this._commitSwipeNavigation(-1)}}_commitSwipeNavigation(t){const e=Date.now();if(e-(this._lastSwipeTime||0)<500){this._wheelSwipeAccum=0;return}this._lastSwipeTime=e,this._swipeActive=!0,this._swipeDirection=t,this._wheelSwipeAccum=0,t<0?this.prev():t>0&&this.next()}_detectWheelMode(t){if(this._wheelMode)return this._wheelMode;if(t.ctrlKey)return this._wheelMode="zoom",this._wheelMode;const e=Math.abs(t.deltaX),i=Math.abs(t.deltaY),s=this.state.baseScale||1,n=Math.abs(this.state.scale-s)<=Math.max(.8,s*.5),o=e>i*.65&&e-i>1||i<2;return n&&o?this._wheelMode="swipe":this._wheelMode="zoom",this._wheelMode}_handleWheelZoom(t){const e=-t.deltaY,i=1.04,s=e>0?i:1/i;this._zoomAtPoint(s,t.clientX,t.clientY)}_scheduleWheelGestureReset(){clearTimeout(this._wheelSwipeTimer),this._wheelSwipeTimer=setTimeout(()=>this._endWheelGesture(),140)}_endWheelGesture(){this._wheelSwipeTimer&&(clearTimeout(this._wheelSwipeTimer),this._wheelSwipeTimer=null),this._wheelSwipeAccum=0,this._swipeActive=!1,this._wheelMode=null,this._swipeDirection=0}_handleUserActivity(){this.state.open&&(this._showUiImmediate(),this._scheduleUiHide())}_scheduleUiHide(){clearTimeout(this._uiHideTimer),this._uiHideTimer=setTimeout(()=>{this._pointerOverUi?this._scheduleUiHide():this._hideUi()},this._uiHideDelay)}_showUiImmediate(){this.nodes?.ui&&(this.nodes.ui.classList.add("spot-ui-visible"),this.nodes.ui.classList.remove("spot-ui-hidden"),this.overlay&&this.overlay.classList.remove("spot-nav-hidden"))}_hideUi(){this.nodes?.ui&&(this.nodes.ui.classList.add("spot-ui-hidden"),this.nodes.ui.classList.remove("spot-ui-visible"),this.overlay&&this.overlay.classList.add("spot-nav-hidden"))}_toggleFullscreen(){this._handleUserActivity(),this.state.fullscreen?this._exitFullscreen():this._enterFullscreen()}_enterFullscreen(){const t=this.overlay;if(!(!t||document.fullscreenElement===t)){if(t.requestFullscreen){const e=t.requestFullscreen();e&&typeof e.catch=="function"&&e.catch(()=>{})}this._syncFullscreenState()}}_exitFullscreen(){if(document.fullscreenElement&&document.exitFullscreen){const t=document.exitFullscreen();t&&typeof t.catch=="function"&&t.catch(()=>{})}this._syncFullscreenState()}_syncFullscreenState(){const t=document.fullscreenElement===this.overlay;this.state.fullscreen=!!t,this._updateFullscreenButton()}_updateFullscreenButton(){const t=this.nodes?.fullscreenBtn;t&&(t.innerHTML=this.state.fullscreen?A:L,t.setAttribute("aria-label",this.state.fullscreen?"Exit fullscreen":"Enter fullscreen"),t.setAttribute("aria-pressed",String(this.state.fullscreen)))}_animateSlide(t,e){this._handleUserActivity(),this._pendingSlideDir=t||0,typeof e=="function"&&e()}_playSlideIn(t){const e=this.nodes?.imgNode;if(!e)return;const i=t||0;e.style.transition="none",i?(e.style.transform=`translateX(${i*60}px) scale(0.96)`,e.style.opacity="0"):(e.style.transform="translateX(0) scale(1)",e.style.opacity="1"),requestAnimationFrame(()=>{e.style.transition="transform 650ms cubic-bezier(0.3, 1, 0.3, 1), opacity 400ms ease",e.style.transform="translateX(0) scale(1)",e.style.opacity="1";const s=()=>{e.style.transition="",e.style.transform="",e.removeEventListener("transitionend",s)};e.addEventListener("transitionend",s,{once:!0})})}_bindPinch(){const t=new Map;let e=0,i=1;const s=a=>{if(this.state.open&&(this._handleUserActivity(),t.set(a.pointerId,a),t.size===2)){const[h,r]=Array.from(t.values());e=Math.hypot(r.clientX-h.clientX,r.clientY-h.clientY),i=this.state.scale}},n=a=>{if(t.has(a.pointerId)){if(!this.state.open){t.clear();return}if(this._handleUserActivity(),t.set(a.pointerId,a),t.size===2){const[h,r]=Array.from(t.values()),d=Math.hypot(r.clientX-h.clientX,r.clientY-h.clientY);if(e>0){const m=1+(d/e-1)*.5;this.state.scale=Math.min(8,Math.max(.2,i*m)),this._startRenderLoop()}}}},o=a=>{t.delete(a.pointerId),t.size<2&&(e=0,i=this.state.scale)};this.nodes.canvas.addEventListener("pointerdown",s),window.addEventListener("pointermove",n),window.addEventListener("pointerup",o),window.addEventListener("pointercancel",o)}openCollection(t,e=0){this.collections[t]&&(this.state.open=!0,this.state.collectionIndex=t,this.state.itemIndex=e,this._handleUserActivity(),this._showOverlay(),this._loadItem())}_showOverlay(){this.overlay.style.display="block",this._lastFocused=document.activeElement,requestAnimationFrame(()=>{this.overlay.classList.add("spot-open"),this.overlay.setAttribute("aria-hidden","false"),document.documentElement.style.overflow="hidden",this._showUiImmediate(),this._scheduleUiHide(),this.nodes.shell.focus()})}close(){this.state.open&&(this.overlay.classList.remove("spot-open"),this.overlay.setAttribute("aria-hidden","true"),document.documentElement.style.overflow="",this.state.open=!1,this.state.fullscreen=!1,this._exitFullscreen(),this._updateFullscreenButton(),clearTimeout(this._uiHideTimer),clearTimeout(this._wheelSwipeTimer),this._wheelSwipeAccum=0,this._wheelMode=null,this._swipeActive=!1,this._swipeDirection=0,this._pendingSlideDir=0,this._hideUi(),setTimeout(()=>{this.state.open||(this.overlay.style.display="none"),this._lastFocused&&this._lastFocused.focus()},220))}prev(){const t=this.collections[this.state.collectionIndex];t&&(this.state.itemIndex=(this.state.itemIndex-1+t.items.length)%t.items.length,this._animateSlide(-1,()=>this._loadItem()))}next(){const t=this.collections[this.state.collectionIndex];t&&(this.state.itemIndex=(this.state.itemIndex+1)%t.items.length,this._animateSlide(1,()=>this._loadItem()))}_loadItem(){const t=this.collections[this.state.collectionIndex];if(!t)return;const e=t.items[this.state.itemIndex];if(!e)return;const i=this._pendingSlideDir||0;this._pendingSlideDir=0,this._resetRenderState(),this.nodes.imgNode.style.opacity="0",this.nodes.imgNode.src="",this.nodes.counter.textContent=`${this.state.itemIndex+1} / ${t.items.length}`,this._updateCaption(e.caption),this.liveRegion&&(this.liveRegion.textContent=`Image ${this.state.itemIndex+1} of ${t.items.length}${e.caption?": "+e.caption:""}`);const s=this.nodes.imgNode;s.onload=null,s.onerror=null,s.style.opacity="0",s.src="",s.onload=()=>{requestAnimationFrame(()=>{this._fitImageToViewport(),this._applyTransform({immediate:!0}),this._playSlideIn(i)})},s.onerror=()=>{s.src="",this._updateCaption("Failed to load image"),s.style.opacity="1"},s.src=e.src,/\.svg($|\?)/i.test(e.src)?s.classList.add("spot-svg"):s.classList.remove("spot-svg"),s.complete&&s.naturalWidth&&s.onload?.()}_updateCaption(t){if(!this.nodes||!this.nodes.caption)return;const e=(t||"").trim();e?(this.nodes.caption.textContent=e,this.nodes.caption.classList.remove("spot-caption-empty"),this.nodes.caption.style.display=""):(this.nodes.caption.textContent="",this.nodes.caption.classList.add("spot-caption-empty"),this.nodes.caption.style.display="none")}_resetRenderState(){this.state.scale=1,this.state.baseScale=1,this.state.translateX=0,this.state.translateY=0,this.renderState.scale=1,this.renderState.translateX=0,this.renderState.translateY=0,this._renderActive=!1,this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=null)}_startRenderLoop(){this._rafId||(this._renderActive=!0,this._renderLoop())}_renderLoop(){if(!this._renderActive||!this.state.open){this._rafId=null;return}const{scale:t,translateX:e,translateY:i}=this.state,s=this.renderState,n=.15;if(s.scale+=(t-s.scale)*n,s.translateX+=(e-s.translateX)*n,s.translateY+=(i-s.translateY)*n,Math.abs(t-s.scale)<.001&&Math.abs(e-s.translateX)<.1&&Math.abs(i-s.translateY)<.1&&(s.scale=t,s.translateX=e,s.translateY=i,this._renderActive=!1),this.nodes.transform){this.nodes.transform.style.transition="none",this.nodes.transform.style.transform=`translate(${s.translateX}px, ${s.translateY}px) scale(${s.scale})`,this._updateZoomDisplay(s.scale);const o=this.nodes.imgNode;o.style.cursor=Math.abs(s.scale-(this.state.baseScale||1))>.02||Math.abs(s.translateX)>1||Math.abs(s.translateY)>1?"grab":"zoom-out"}this._renderActive?this._rafId=requestAnimationFrame(()=>this._renderLoop()):this._rafId=null}_fitImageToViewport(){const t=this.nodes?.imgNode;if(!t)return;const e=Math.max(window.innerWidth,1),i=Math.max(window.innerHeight,1),s=t.naturalWidth||t.width||t.clientWidth,n=t.naturalHeight||t.height||t.clientHeight;if(!s||!n)return;const o=e/s,a=i/n,h=e>=i;let r=1;if(h){const d=s<=e,p=n<=i;d||p?r=1:r=a,r=Math.min(r,1)}else r=Math.min(o,a);r=Math.min(8,Math.max(.05,r)),this.state.baseScale=r,this.state.scale=r,this.state.translateX=0,this.state.translateY=0,this.renderState.scale=r,this.renderState.translateX=0,this.renderState.translateY=0}_applyTransform(t={}){const e=t.immediate||!this.state.open;if(!this.nodes||!this.nodes.transform)return;const{scale:i,translateX:s,translateY:n}=this.state,o=this.nodes.transform;e?o.style.transition="none":o.style.transition="",o.style.transform=`translate(${s}px, ${n}px) scale(${i})`,this._updateZoomDisplay(i);const a=this.nodes.imgNode;a.style.cursor=Math.abs(i-(this.state.baseScale||1))>.02||Math.abs(s)>1||Math.abs(n)>1?"grab":"zoom-out"}_updateZoomDisplay(t){if(!this.nodes||!this.nodes.zoomDisplay)return;const e=Math.round((t||1)*100);this.nodes.zoomDisplay.textContent=`${e}%`,this.nodes.zoomDisplay.title=`Reset zoom (${e}%)`}_zoomBy(t){this._handleUserActivity(),this.state.scale=Math.min(8,Math.max(.2,this.state.scale*t)),this._startRenderLoop()}_resetZoom(){this._handleUserActivity(),this.state.scale=this.state.baseScale||1,this.state.translateX=0,this.state.translateY=0,this._startRenderLoop()}_zoomAtPoint(t,e,i){this._handleUserActivity();const s=(this.nodes.transform||this.nodes.imgNode).getBoundingClientRect(),n=e-s.left,o=i-s.top,a=this.state.scale,h=Math.min(8,Math.max(.2,a*t)),r=n/s.width,d=o/s.height,p=a,m=h,u=(r-.5)*s.width*(m/p-1),_=(d-.5)*s.height*(m/p-1);this.state.translateX-=u,this.state.translateY-=_,this.state.scale=h,this._startRenderLoop()}attachImage(t,e,i){t.dataset.spotlightCollection=String(e),t.dataset.spotlightIndex=String(i),t.addEventListener("click",s=>{s.preventDefault(),this.openCollection(e,i)})}_injectStyles(){if(document.getElementById("spotlight-styles"))return;const t=`:root{--spot-bg:rgba(6,6,8,1);--spot-ui-bg:rgba(20,20,24,0.78);--spot-ui-fg:rgba(255,255,255,0.95);--spot-muted:rgba(255,255,255,0.74);--spot-btn-bg:rgba(255,255,255,0.08);--spot-btn-border:rgba(255,255,255,0.1);--spot-shadow:0 10px 40px rgba(0,0,0,0.45);--spot-anim:300ms cubic-bezier(.22,.9,.35,1);--spot-font:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif}@media (prefers-color-scheme:light){:root{--spot-bg:rgba(250,250,252,1);--spot-ui-bg:rgba(255,255,255,0.8);--spot-ui-fg:rgba(17,17,20,0.92);--spot-muted:rgba(17,17,20,0.7);--spot-btn-bg:rgba(0,0,0,0.05);--spot-btn-border:rgba(0,0,0,0.1);--spot-shadow:0 2px 80px rgba(0,0,0,0.15)}#spot-overlay .spot-nav{background:rgba(255,255,255,.92);border-color:rgba(0,0,0,.06);box-shadow:0 6px 18px rgba(10,10,10,.06)}#spot-overlay .spot-nav:hover{background:rgba(245,245,245,.98)}}#spot-overlay{display:none;position:fixed;inset:0;z-index:2147483646;font-family:var(--spot-font);-webkit-font-smoothing:antialiased;opacity:0;transition:opacity var(--spot-anim);touch-action:none}#spot-overlay,#spot-overlay *{-webkit-user-select:none;user-select:none}#spot-overlay.spot-open{pointer-events:auto;opacity:1}#spot-bg,.spot-nav svg{transition:opacity var(--spot-anim)}#spot-bg,#spot-shell{position:fixed;inset:0;opacity:0}#spot-bg{background:var(--spot-bg)}#spot-shell{pointer-events:none;transform:scale(.996);transition:opacity var(--spot-anim),transform var(--spot-anim)}#spot-overlay.spot-open #spot-shell{opacity:1;transform:scale(1)}#spot-overlay.spot-open #spot-bg,.spot-controls .spot-btn:hover,.spot-nav:hover svg{opacity:1}#spot-canvas,#spot-stage{inset:0;display:flex;align-items:center;justify-content:center}#spot-stage{position:fixed;pointer-events:none;z-index:2147483645}#spot-canvas{position:absolute;overflow:hidden;pointer-events:auto}#spot-transform{will-change:transform;touch-action:none;transform-origin:center center;cursor:grab;transition:transform var(--spot-anim)}#spot-transform img{display:block;width:auto;height:auto;max-width:none;max-height:none;object-fit:contain;user-select:none;-webkit-user-drag:none;pointer-events:auto;transition:opacity 180ms ease}#spot-transform img.spot-svg{width:100%;height:auto;max-width:100vw;max-height:100vh}.spot-caption,.spot-nav,.spot-topbar{pointer-events:auto;color:var(--spot-ui-fg);box-shadow:var(--spot-shadow)}.spot-nav{position:absolute;top:50%;transform:translateY(-50%);width:50px;height:50px;border-radius:50%;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.12);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;font-size:0;cursor:pointer;opacity:1;transition:background var(--spot-anim),transform var(--spot-anim),opacity var(--spot-anim);z-index:2147483650}.spot-nav svg{width:30px;height:30px;opacity:.5}.spot-nav:hover{background:rgba(0,0,0,.45)}.spot-nav[data-dir="-1"]{left:22px;--nav-offset:-40px}.spot-nav[data-dir="1"]{right:22px;--nav-offset:40px}#spot-ui{position:fixed;inset:0;pointer-events:none;display:flex;flex-direction:column;justify-content:space-between;gap:20px;z-index:2147483647}.spot-caption,.spot-topbar{background:var(--spot-ui-bg);backdrop-filter:blur(18px)}.spot-controls,.spot-topbar{display:flex;align-items:center}.spot-topbar{gap:18px;height:50px}.spot-controls{margin-left:auto;gap:10px}.spot-controls svg{width:21px;height:21px}.spot-controls .spot-btn{opacity:.5;transition:opacity var(--spot-anim),background 150ms ease;will-change:opacity}.spot-btn,.spot-counter{height:50px;color:var(--spot-ui-fg);display:flex;justify-content:center;font-weight:600}.spot-counter{font-size:15px;letter-spacing:.08em;opacity:.5;min-width:10ch;max-width:12ch;padding:15px;box-sizing:border-box;align-items:flex-end;white-space:nowrap;font-variant-numeric:tabular-nums;-webkit-font-feature-settings:"tnum"1;font-feature-settings:"tnum"1}.spot-btn{width:50px;border-radius:6px;border:0;background:0 0;align-items:center;font-size:16px;cursor:pointer;transition:background 150ms ease}.spot-btn:active{transform:none}#spot-caption{padding:14px 18px;font-size:21px;line-height:1.45;color:var(--spot-muted)}#spot-caption.spot-caption-empty{opacity:0;pointer-events:none}#spot-overlay.spot-nav-hidden .spot-nav{opacity:0;pointer-events:none;transform:translateY(-50%) translateX(var(--nav-offset))}#spot-ui .spot-caption,#spot-ui .spot-topbar{transition:opacity var(--spot-anim),transform var(--spot-anim);will-change:opacity,transform}#spot-ui.spot-ui-hidden .spot-topbar{opacity:0;transform:translateY(-18px);pointer-events:none}#spot-ui.spot-ui-hidden .spot-caption{opacity:0;transform:translateY(18px);pointer-events:none}#spot-ui.spot-ui-visible .spot-caption,#spot-ui.spot-ui-visible .spot-topbar{opacity:1;transform:translateY(0)}@media (max-width:600px){#spot-ui{padding:12px}.spot-topbar{gap:10px}.spot-counter{min-width:auto;font-size:14px;padding:0 8px;height:40px}.spot-btn,.spot-nav{width:40px;height:40px}.spot-nav[data-dir="-1"]{left:10px;--nav-offset:-20px}.spot-nav[data-dir="1"]{right:10px;--nav-offset:20px}}@media (prefers-reduced-motion:reduce){:root{--spot-anim:0s}#spot-transform{transition:none}}`,e=l("style",{id:"spotlight-styles",type:"text/css"});e.appendChild(document.createTextNode(t)),document.head.appendChild(e)}_handleKeydown(t){if(!this.state.open)return;this._handleUserActivity();const e=t.code||"",i=t.key||"",s=String(i).toLowerCase();if(e==="Escape"||i==="Escape"||i==="Esc"){this.close();return}this._handleNavigation(e,i,s)||this._handleZoom(e,i)||(this._isResetZoomKey(e,i)?this._resetZoom():(e==="KeyF"||s==="f")&&this._toggleFullscreen())}_handleNavigation(t,e,i){return this._isNextKey(t,e,i)?(this.next(),!0):this._isPrevKey(t,e,i)?(this.prev(),!0):!1}_handleZoom(t,e){return this._isZoomInKey(t,e)?(this._zoomBy(1.2),!0):this._isZoomOutKey(t,e)?(this._zoomBy(1/1.2),!0):!1}_isNextKey(t,e,i){return t==="ArrowRight"||t==="KeyL"||e==="ArrowRight"||i==="l"||e==="Right"}_isPrevKey(t,e,i){return t==="ArrowLeft"||t==="KeyH"||e==="ArrowLeft"||i==="h"||e==="Left"}_isZoomInKey(t,e){return t==="Equal"||t==="NumpadAdd"||e==="+"||e==="="}_isZoomOutKey(t,e){return t==="Minus"||t==="NumpadSubtract"||e==="-"||e==="_"}_isResetZoomKey(t,e){return t==="Digit0"||t==="Numpad0"||e==="0"||e===")"}_handleTouchEnd(t){if(!this.state.open||!this.touchStart)return;this._handleUserActivity();const e=t.changedTouches&&t.changedTouches[0]&&t.changedTouches[0].clientX||0,i=t.changedTouches&&t.changedTouches[0]&&t.changedTouches[0].clientY||0,s=e-this.touchStart.x,n=i-this.touchStart.y,o=Date.now()-this.touchStart.t;this.touchStart=null,this._isValidSwipe(s,n,o)&&(s<0?this.next():this.prev())}_isValidSwipe(t,e,i){const s=Math.abs(t),n=Math.abs(e);return s>n&&s>20&&i<500&&Math.abs(this.state.scale-(this.state.baseScale||1))<.25}}function b(){if(window.__spotlight_instance)return window.__spotlight_instance;const c=new C;return window.__spotlight_instance=c,c}const g=b;window.addEventListener("click",c=>{const t=c.target.closest("img");if(!t||!t.closest("article, .gallery"))return;c.preventDefault();const i=b(),s=parseInt(t.dataset.spotlightCollection||"0",10),n=parseInt(t.dataset.spotlightIndex||"0",10);i.openCollection(s,n)}),window.Spotlight={get instance(){return window.__spotlight_instance||null},open:(c=0,t=0)=>{window.__spotlight_instance||g(),window.__spotlight_instance.openCollection(c,t)},rescan:()=>{const c=window.__spotlight_instance||g();try{c.overlay&&c.overlay.parentNode&&c.overlay.parentNode.removeChild(c.overlay)}catch{}return delete window.__spotlight_instance,g()}}})()})();
